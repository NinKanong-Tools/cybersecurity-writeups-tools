# Exiftool

### What is Exiftool?
ExifTool is developed by Phil Harvey. It is a platform-independent Perl library coupled with a full-featured command-line implementation for reading, writing and manipulating the metadata across a broad range of files, particularly the JPEG images. This metadata may comprise a bunch of information such as the camera make, file type, permissions, file size etc., though it further offers more details about the photograph, like the exposure, the shutter speed and whether the flash fired or not. ExifTool probably gives us the simplest way to extract metadata from files, as it is free and an open-source program.

## 1. Installation Exiftool
````
sudo apt install libimage-exiftool-perl -y
````
<img width="650" height="199" alt="image" src="https://github.com/user-attachments/assets/3898c0e5-3feb-448b-8a71-052a2e3d2a6f" />


- Check version
````
exiftool -ver
````

<img width="182" height="78" alt="image" src="https://github.com/user-attachments/assets/b3148e11-20e9-42a8-9cf1-b58cc5e16fb2" />


## Usage of exiftool

### 1. Reading Metadata
#### 1. Basic Metadata Extraction
first i have a picture this:

<img width="686" height="538" alt="image" src="https://github.com/user-attachments/assets/e83bf96a-c6ea-4ba0-ba19-3de079efe090" />

````
exiftool '/var/run/vmblock-fuse/blockdir/nqQQtR/test.jpg.jpg'
````
<img width="588" height="413" alt="image" src="https://github.com/user-attachments/assets/b724bef2-3faa-44a2-8668-e1af59bac30e" />

It use to extract the entire metadata of a file.

````
exiftool -H /var/run/vmblock-fuse/blockdir/nqQQtR/test.jpg.jpg
````
<img width="645" height="415" alt="image" src="https://github.com/user-attachments/assets/af73522f-a398-44b5-a022-a20bf96cbba5" />

From the below image, we can see that there is a lot of information stored within these Exif tags.


#### 2. Display Metadata with Tag Names

I have a pictute like this:
<img width="624" height="501" alt="image" src="https://github.com/user-attachments/assets/f010598e-4687-44f8-9d11-c6229d2ff06b" />

if we show metadata with internal tag names instead of descriptions.
````
exiftool -s -all /home/k4n0ng/Pictures/test.jpeg
````
<img width="508" height="416" alt="image" src="https://github.com/user-attachments/assets/162bd550-1c0d-4982-ba1d-df83c722b910" />

- -s to show tag names.


#### 3. Extract Specific Tags
````
exiftool -FileName -ImageSize -EXIF:FNumber -XMP:All /home/k4n0ng/Pictures/test.jpeg
````
<img width="726" height="83" alt="image" src="https://github.com/user-attachments/assets/fd6c6ffe-0314-45dc-967f-1daf25ce6ceb" />

Outputs the file name, image dimensions, aperture (FNumber), and all XMP tags for test.jpeg.

#### 4. List Focal Length for All Files in a Directory
````
exiftool -FocalLength35efl .
exiftool -FocalLength35efl . /home/k4n0ng/Pictures/test.jpeg
````
<img width="534" height="175" alt="image" src="https://github.com/user-attachments/assets/271cdc5a-c4d0-402d-a4cd-cf8dedba78f4" />

- Show the 35mm equivalent focal length for all images in the current directory.
- Queries the FocalLength35efl tag for all files in the current directory (.).


### 2. Writing Metadata
These commands show how to modify metadata in files.

#### 1. Add a Comment to an Image
````
exiftool -Comment="Hello world! " /home/k4n0ng/Pictures/test.jpeg
````
<img width="643" height="578" alt="image" src="https://github.com/user-attachments/assets/2202fe1b-b5b2-41ee-adac-ddfe35da89b1" />

Write a new comment to a JPEG image.


#### 2. Set Copyright Information

Add a copyright notice based on the creation year.
````
exiftool -d %Y -Copyright="Copyright $CreateDate, k4n0ng" /var/run/vmblock-fuse/blockdir/gRq8Dm/test2.jpg
````

Show only the Copyright tag
````
exiftool -Copyright /var/run/vmblock-fuse/blockdir/gRq8Dm/test2.jpg
````

Show multiple related tags (in case Copyright is under XMP/IPTC/EXIF)
````
exiftool -a -G1 -s -Copyright* /var/run/vmblock-fuse/blockdir/gRq8Dm/test2.jpg
````

Show full metadata (search manually)
````
exiftool /var/run/vmblock-fuse/blockdir/gRq8Dm/test2.jpg | grep -i copyright
````
<img width="886" height="365" alt="image" src="https://github.com/user-attachments/assets/01e52cf2-ee2c-476d-84fb-5fab8273b7f8" />

- How to confirm that it coypright or not
- Right-click the image → Properties.
- Go to the Details tab.
- Look under Origin or Copyright field → you’ll see:

<img width="947" height="747" alt="image" src="https://github.com/user-attachments/assets/f67680f1-19da-46bc-9043-422b11576a16" />

- -d %Y to format CreateDate as a year and sets the Copyright tag dynamically.


#### 3. Update Camera Make
````
exiftool -Make="kali" "/var/run/vmblock-fuse/blockdir/HT5Yet/test2.jpg"
````
<img width="617" height="73" alt="image" src="https://github.com/user-attachments/assets/1b14a6e3-b313-490f-8087-053bdead9c84" />

- Replaces the Make tag value (e.g., from “OPPO” to “kali”).

- How to check it:
````
exiftool -Make /var/run/vmblock-fuse/blockdir/HT5Yet/test2.jpg
````

<img width="564" height="75" alt="image" src="https://github.com/user-attachments/assets/d3d5e410-8c50-4221-9ca5-f7a090061745" />



### 3. Removing Metadata
In These commands strip metadata from files.

#### 1. Remove All Metadata
````
exiftool -All= /home/k4n0ng/Pictures/test.jpeg
````
<img width="421" height="72" alt="image" src="https://github.com/user-attachments/assets/19719985-c8fc-4e13-ba00-9a115d048f57" />

- -All= : The All= option deletes all metadata from the file. That includes EXIF, IPTC, XMP, GPS info, camera model, timestamps, etc.


#### 2. Remove GPS Metadata Only
````
exiftool -gps:all= /home/k4n0ng/Pictures/kali.jpg
````
<img width="446" height="85" alt="image" src="https://github.com/user-attachments/assets/8059979c-4717-49c0-b9d5-b06acad87976" />

In this it will removes all GPS tags.


### 4. Copying/Moving Metadata

#### 1. Copy Metadata from One File to Another
````
exiftool -tagsFromFile '/home/k4n0ng/Pictures/kali.jpg' -all:all '/home/k4n0ng/Pictures/test.jpeg'
````
<img width="829" height="83" alt="image" src="https://github.com/user-attachments/assets/f85853ce-3d54-4c7f-8847-6f739d216db3" />

- -tagsFromFile '/home/k4n0ng/Pictures/test.jpeg' :  Copy all metadata tags from test.jpeg.
- -all:all : Means copy all possible metadata.

##### 1. check if metadata was copied:
- View metadata of test.jpeg:
````
exiftool /home/k4n0ng/Pictures/test.jpeg
````
<img width="510" height="429" alt="image" src="https://github.com/user-attachments/assets/53d42194-d858-4874-884c-67f18eccb977" />


#### 2. Copy Specific Tags
- Check if Make and Model exist
````
exiftool -Make -Model /home/k4n0ng/Pictures/test.jpeg
````

- If metadata is missing, you need to add it manually first
````
exiftool -Make="Canon" -Model="EOS 80D" /home/k4n0ng/Pictures/test.jpeg
````

- Then you can map them to Subject
````
exiftool "-Subject<Make" "-Subject<Model" /home/k4n0ng/Pictures/test.jpeg
````

- Check existing tags
````
exiftool -Make -Model /home/k4n0ng/Pictures/test.jpeg
````
<img width="640" height="368" alt="image" src="https://github.com/user-attachments/assets/2e52cd45-b50f-40af-a69c-e9a6350b4f72" />

- Check subjeck
````
exiftool -Subject /home/k4n0ng/Pictures/test.jpeg
````
<img width="441" height="96" alt="image" src="https://github.com/user-attachments/assets/56a8c270-042f-469a-9c81-80fdb003ce85" />


#### 3. Copy Metadata from Video to Image
- first i have a video like this:
<img width="552" height="444" alt="image" src="https://github.com/user-attachments/assets/51916d86-0180-4a24-81a6-346324c31cc3" />

````
exiftool -v -r -overwrite_original -tagsFromFile %d%f.mp4 -all:all -xmp:all -exif:all -composite:all -quicktime:all -iptc:all -gps:all '/home/k4n0ng/Videos/test.mp4'
````
<img width="1004" height="410" alt="image" src="https://github.com/user-attachments/assets/ef3631ca-38a0-4d68-902d-8630a624d182" />

- -v → verbose mode, shows detailed info.
- -overwrite_original → updates /home/k4n0ng/Videos/test.mp4 directly.
- -tagsFromFile ../Videos/test.mp4 → source file is your MP4 video.
- -all:all ... -gps:all → copies all types of metadata.
- /home/k4n0ng/Videos/test.mp4 → the target image that will receive the metadata.


- View all metadata of your video:
````
exiftool /home/k4n0ng/Videos/test.mp4
````
<img width="435" height="717" alt="image" src="https://github.com/user-attachments/assets/c31db0c8-5bbb-481f-b555-e6bf34540be7" />

This will list all metadata tags: creation date, modification date, GPS info, XMP, QuickTime, IPTC, etc.

- Check specific tags
````
exiftool -DateTimeOriginal -CreateDate -ModifyDate -GPSLatitude -GPSLongitude /home/k4n0ng/Videos/test.mp4
````
<img width="790" height="76" alt="image" src="https://github.com/user-attachments/assets/38a66de0-849d-4e44-9f3e-17e1cf2ef335" />


### 5. Renaming Files Based on Metadata

#### 1. Rename Files Using Date/Time
````
exiftool -r 'kali.jpg<DateTimeOriginal' -d %Y-%m-%d_%H-%M-%S%%lc.%%e .
````
<img width="533" height="704" alt="image" src="https://github.com/user-attachments/assets/5c665033-ffc6-4a82-a814-797f6daeaac3" />

- -r : Recursively process files in the current folder and all subfolders.
- '-FileName<DateTimeOriginal' : Tells ExifTool to rename the file using the DateTimeOriginal tag (when the photo/video was taken).
- -d %Y-%m-%d_%H-%M-%S%%lc.%%e : Specifies the date format for the new filename:
     - %Y → 4-digit year
     - %m → 2-digit month
     - %d → 2-digit day
     - %H → hour (24h)
     - %M → minute
     - %S → second
     - %%lc → converts the original filename to lowercase letters
     - %%e → keeps the original file extension
- . : Process all files in the current directory (and subfolders because of -r).


### 6. Geotagging

#### 1. Geotag Images from a GPS Track Log
````
exiftool -plot GPSAltitude .
````
<img width="821" height="584" alt="image" src="https://github.com/user-attachments/assets/18f10362-0e8c-47f6-b129-f2d7ae8dfd00" />

- -plot GPSAltitude : Tells ExifTool to generate a plot/graph of the GPSAltitude metadata from your images.
   - GPSAltitude = the altitude (height above sea level) stored in the GPS metadata of each image.
   - ExifTool will create a SVG graph showing how the altitude changes across your photos.


### 7. Batch Processing

#### 1. Process All JPEG Files in a Directory
````
exiftool -ext jpg .
````
<img width="490" height="634" alt="image" src="https://github.com/user-attachments/assets/5ce21203-4a69-4e13-86b7-bf79b1732ba5" />

- It will processes only files with a .jpg extension in the current directory. Use --ext to exclude specific extensions.

#### 2. Recursively Process a Directory
- For testing first we need to create 
````
cd Documents
ls
mkdir exiftool_demo
````
in exiftool_demo we need to have picture:
<img width="642" height="454" alt="image" src="https://github.com/user-attachments/assets/484e3b64-6991-4c63-ab83-7e832fb8f4ab" />

<img width="275" height="142" alt="image" src="https://github.com/user-attachments/assets/420c4963-b694-4f87-9b69-6099a50cb193" />

- Extract metadata from all files in a folder and its subfolders
````
exiftool -r ~/Documents/exiftool_demo
````
<img width="589" height="479" alt="image" src="https://github.com/user-attachments/assets/6d5530bc-aa2e-4649-b9cc-765ab0e73703" />

-r : recursively processes all files in the folder (and subfolders if any).



### 8. Filtering and Conditional Processing

#### 1. Process Canon Images Only Extract shutter speed from Canon images.

````
exiftool -ShutterSpeed -if '$Make eq "Canon"' Pictures
````
<img width="495" height="109" alt="image" src="https://github.com/user-attachments/assets/85107d61-98f0-4c3a-af7f-d55660258a0d" />

- Check all tags for that pictures
````
exiftool Pictures/kali.jpg
````
<img width="546" height="414" alt="image" src="https://github.com/user-attachments/assets/5055dcad-a085-4789-9659-06438319d6df" />




### 9. Python script
````
nano Exiftool.py
````

````
#!/usr/bin/env python3
"""
METADATA EXTRACTION TOOL - EXIFTOOL-LIKE UTILITY
🔍 For digital forensics and security analysis
🛡️ Legal and ethical use only
"""

import os
import sys
import argparse
import json
from datetime import datetime
from pathlib import Path

# Try to import EXIF libraries
try:
    import exifread
    EXIFREAD_AVAILABLE = True
except ImportError:
    EXIFREAD_AVAILABLE = False

try:
    from PIL import Image
    from PIL.ExifTags import TAGS
    PILLOW_AVAILABLE = True
except ImportError:
    PILLOW_AVAILABLE = False

class MetaDataAnalyzer:
    def __init__(self):
        self.files_processed = 0
        self.files_with_metadata = 0
        
    def display_banner(self):
        """Display tool banner"""
        banner = f"""
    ╔══════════════════════════════════════════════════════════╗
    ║                                                          ║
    ║                 METADATA EXTRACTION TOOL                 ║
    ║                 Digital Forensics Utility                ║
    ║                                                          ║
    ║    Version: 1.0                                          ║
    ║    Author: Security Researcher                           ║
    ║    Purpose: Legal metadata analysis                      ║
    ║                                                          ║
    ╚══════════════════════════════════════════════════════════╝
    
    Current directory: {os.getcwd()}
    Legal use only - For authorized security analysis
        """
        print(banner)
    
    def check_dependencies(self):
        """Check if required libraries are available"""
        print("Checking dependencies...")
        
        if not EXIFREAD_AVAILABLE:
            print(" exifread not installed. Install with: pip install exifread")
        
        if not PILLOW_AVAILABLE:
            print(" Pillow not installed. Install with: pip install Pillow")
        
        if not EXIFREAD_AVAILABLE and not PILLOW_AVAILABLE:
            print("\n To install all dependencies:")
            print("   pip install exifread Pillow")
            return False
        
        return True
    
    def extract_basic_metadata(self, file_path):
        """Extract basic file metadata"""
        try:
            file_stat = os.stat(file_path)
            return {
                'file_size': f"{file_stat.st_size} bytes",
                'creation_time': datetime.fromtimestamp(file_stat.st_ctime).strftime('%Y-%m-%d %H:%M:%S'),
                'modification_time': datetime.fromtimestamp(file_stat.st_mtime).strftime('%Y-%m-%d %H:%M:%S'),
                'file_permissions': oct(file_stat.st_mode)[-3:]
            }
        except Exception as e:
            return {'error': f'Failed to get basic metadata: {e}'}
    
    def extract_exif_with_exifread(self, file_path):
        """Extract EXIF data using exifread"""
        if not EXIFREAD_AVAILABLE:
            return {'error': 'exifread library not available'}
        
        try:
            with open(file_path, 'rb') as f:
                tags = exifread.process_file(f, details=False)
            
            exif_data = {}
            for tag, value in tags.items():
                if tag not in ('JPEGThumbnail', 'TIFFThumbnail', 'Filename', 'EXIF MakerNote'):
                    exif_data[tag] = str(value)
            
            return exif_data
        except Exception as e:
            return {'error': f'exifread error: {e}'}
    
    def extract_exif_with_pillow(self, file_path):
        """Extract EXIF data using Pillow"""
        if not PILLOW_AVAILABLE:
            return {'error': 'Pillow library not available'}
        
        try:
            image = Image.open(file_path)
            exif_data = {}
            
            if hasattr(image, '_getexif') and image._getexif() is not None:
                for tag, value in image._getexif().items():
                    tag_name = TAGS.get(tag, tag)
                    exif_data[tag_name] = str(value)
            
            return exif_data
        except Exception as e:
            return {'error': f'Pillow error: {e}'}
    
    def analyze_file(self, file_path, output_format='text'):
        """Analyze a single file"""
        try:
            print(f"\n Analyzing: {file_path}")
            print("─" * 60)
            
            results = {
                'file_info': self.extract_basic_metadata(file_path),
                'exifread_data': self.extract_exif_with_exifread(file_path),
                'pillow_data': self.extract_exif_with_pillow(file_path)
            }
            
            self.files_processed += 1
            if any(results[key] for key in ['exifread_data', 'pillow_data'] if isinstance(results[key], dict)):
                self.files_with_metadata += 1
            
            if output_format == 'json':
                return json.dumps(results, indent=2)
            else:
                return self.format_text_output(results)
                
        except Exception as e:
            return f" Error analyzing {file_path}: {e}"
    
    def format_text_output(self, results):
        """Format results as text"""
        output = []
        
        # Basic file info
        output.append(" BASIC FILE INFORMATION:")
        for key, value in results['file_info'].items():
            output.append(f"   {key:20}: {value}")
        
        # EXIF data from exifread
        if isinstance(results['exifread_data'], dict) and 'error' not in results['exifread_data'] and results['exifread_data']:
            output.append("\n📸 EXIF DATA (exifread):")
            for key, value in results['exifread_data'].items():
                if len(str(value)) < 100:  # Avoid printing very long values
                    output.append(f"   {key:25}: {value}")
        
        # EXIF data from Pillow
        if isinstance(results['pillow_data'], dict) and 'error' not in results['pillow_data'] and results['pillow_data']:
            output.append("\n EXIF DATA (Pillow):")
            for key, value in results['pillow_data'].items():
                if len(str(value)) < 100:
                    output.append(f"   {key:25}: {value}")
        
        return "\n".join(output)
    
    def find_image_files(self, directory, extensions=None):
        """Find image files in directory"""
        if extensions is None:
            extensions = ['.jpg', '.jpeg', '.png', '.tiff', '.tif', '.gif', '.bmp', '.webp']
        
        image_files = []
        for root, _, files in os.walk(directory):
            for file in files:
                if any(file.lower().endswith(ext) for ext in extensions):
                    image_files.append(os.path.join(root, file))
        
        return image_files
    
    def generate_report(self, directory):
        """Generate summary report"""
        return f"""
ANALYSIS REPORT:
────────────────────────────────────────
Directory analyzed: {directory}
Files processed: {self.files_processed}
Files with metadata: {self.files_with_metadata}
Analysis completed: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}

SECURITY NOTES:
• EXIF data can reveal location, device info, and timestamps
• Always sanitize metadata before sharing images online
• This tool is for legitimate security analysis only
        """
    
    def run_analysis(self, args):
        """Main analysis function"""
        self.display_banner()
        
        if not self.check_dependencies():
            print("\n Some features may not work without dependencies")
        
        target_path = args.path
        output_format = args.format
        recursive = args.recursive
        
        if not os.path.exists(target_path):
            print(f"Path does not exist: {target_path}")
            print(" Try these examples:")
            print("   python Exiftool.py image.jpg")
            print("   python Exiftool.py /path/to/directory")
            print("   python Exiftool.py .  (current directory)")
            return
        
        if os.path.isfile(target_path):
            # Single file analysis
            result = self.analyze_file(target_path, output_format)
            print(result)
            
        else:
            # Directory analysis
            if recursive:
                files = self.find_image_files(target_path)
            else:
                files = [os.path.join(target_path, f) for f in os.listdir(target_path) 
                        if os.path.isfile(os.path.join(target_path, f)) and 
                        any(f.lower().endswith(ext) for ext in ['.jpg', '.jpeg', '.png', '.tiff', '.tif', '.gif', '.bmp', '.webp'])]
            
            if not files:
                print(f" No supported image files found in: {target_path}")
                print(" Supported formats: JPG, JPEG, PNG, TIFF, GIF, BMP, WebP")
                return
            
            print(f" Found {len(files)} image files to analyze...\n")
            
            for file_path in files:
                try:
                    result = self.analyze_file(file_path, output_format)
                    print(result)
                    print("\n" + "═" * 60)
                except KeyboardInterrupt:
                    print("\n⏹Analysis interrupted by user")
                    break
                except Exception as e:
                    print(f" Skipping {file_path}: {e}")
            
            # Generate summary report
            print(self.generate_report(target_path))

def main():
    """Main function"""
    parser = argparse.ArgumentParser(
        description="Metadata Extraction Tool - EXIF analysis for security purposes",
        epilog="Example: python meta_tool.py image.jpg --format json"
    )
    
    parser.add_argument('path', help='File or directory path to analyze')
    parser.add_argument('-f', '--format', choices=['text', 'json'], default='text',
                       help='Output format (default: text)')
    parser.add_argument('-r', '--recursive', action='store_true',
                       help='Recursively analyze directories')
    parser.add_argument('-o', '--output', help='Output file to save results')
    
    # If no arguments provided, show help
    if len(sys.argv) == 1:
        parser.print_help()
        print("\n Quick examples:")
        print("   python Exiftool.py image.jpg          # Analyze single file")
        print("   python Exiftool.py . -r               # Analyze current directory recursively")
        print("   python Exiftool.py /path -f json      # JSON output format")
        sys.exit(1)
    
    args = parser.parse_args()
    
    try:
        analyzer = MetaDataAnalyzer()
        analyzer.run_analysis(args)
        
    except KeyboardInterrupt:
        print("\n\n⏹Analysis stopped by user")
    except Exception as e:
        print(f" Error: {e}")
        sys.exit(1)

if __name__ == "__main__":
    main()
````

<img width="952" height="742" alt="image" src="https://github.com/user-attachments/assets/e2fdd167-ae41-4a44-9bcc-78de20866270" />

In this i run in  vs code.

run script
<img width="459" height="344" alt="image" src="https://github.com/user-attachments/assets/e96e2a8c-dbdc-44cd-be1a-cd599360e059" />

in kali 
````
python Exiftool.py
````

````
python Exiftool.py '/home/k4n0ng/Pictures/kali.jpg'
````
<img width="851" height="599" alt="image" src="https://github.com/user-attachments/assets/84b3ec71-3fea-426f-9875-2aaa46127681" />




#### ==========>> End of Exiftool

### Practice in LAB by: Nin Kanong(k4n0ng)

#### Date: 21/Aug/2025
