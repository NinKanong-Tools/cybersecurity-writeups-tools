# dig


### What is dig?
dig (Domain Information Groper) command is a powerful and flexible DNS lookup tool used for querying DNS servers and troubleshooting DNS issues. It's commonly used in penetration testing, network administration, and reconnaissance.

#### LAB Tool
Kali Linux

#### 1. Basic DNS Query
````
dig google.com
````
<img width="567" height="429" alt="image" src="https://github.com/user-attachments/assets/334f612e-4520-469e-950f-ec072b8eddda" />

- Queries the A record (IPv4) of google.com

#### 2. Query Specific Record Types

##### 1. A Record  IPv4 Address
````
dig google.com A +short
````
<img width="253" height="141" alt="image" src="https://github.com/user-attachments/assets/befb063e-b005-467f-9267-7b52c370b6e5" />

- Use this to find the server IP of a website.

##### 2. AAAA Record – IPv6 Address
````
dig google.com AAAA +short
````
<img width="337" height="115" alt="image" src="https://github.com/user-attachments/assets/f66e8f52-6644-4ad1-a377-c925df058d39" />

- Useful for IPv6-enabled services.

##### 3. MX Record – Mail Exchange
````
dig google.com MX +short
````
<img width="288" height="115" alt="image" src="https://github.com/user-attachments/assets/b9efc848-1acc-46d1-8819-122344108790" />

- Specifies mail servers for the domain. 

##### 4. TXT Record – Text Information
````
dig google.com TXT +short
````
<img width="597" height="203" alt="image" src="https://github.com/user-attachments/assets/5db6bdb0-26ae-4fc0-9073-2b12cad5c059" />

- Stores text info like SPF, DKIM, DMARC, verification records.

##### 5. NS Record – Name Servers
````
dig google.com NS +short
````
<img width="285" height="116" alt="image" src="https://github.com/user-attachments/assets/3e77e11e-08b9-407d-89fc-04258d584640" />

- Use for identifying DNS providers or targeting zone transfers.


##### 6. CNAME Record  Canonical Name (Alias)
````
dig WWW.google.com CNAME 
````
<img width="916" height="355" alt="image" src="https://github.com/user-attachments/assets/dc5ed19f-7fed-4451-b728-21873376229b" />

- CNAME record is a type of DNS record that aliases one domain name to another.


##### 7. SOA Record  Start of Authority
````
dig example.com SOA +short
````
<img width="544" height="113" alt="image" src="https://github.com/user-attachments/assets/09872d6f-5380-428f-afb4-519929011b8a" />

- SOA record is a type of DNS record that provides authoritative information about a domain.


##### 8. PTR Record  Pointer (Reverse DNS)
````
dig =x 8.8.8.8 +short
````
<img width="233" height="123" alt="image" src="https://github.com/user-attachments/assets/909b051b-9eb2-4d91-9e17-66290f46f564" />

- -x : Use for takes an IP address as input and queries the DNS system for the corresponding PTR (Pointer) record, which maps the IP address to a hostname.


#####  9. SRV Record  Service Location
````
dig _sip._tcp.ababank.com SRV
````
<img width="1001" height="369" alt="image" src="https://github.com/user-attachments/assets/b1d32841-8ef7-4f8d-8f81-50b1b972bf27" />

- This command used to query the SRV (Service) DNS record for the _sip._tcp.ababank.com domain.


##### 10. CAA Record  Certification Authority Authorization
````
dig ababank.com CAA +short
dig google.com CAA
````
<img width="601" height="444" alt="image" src="https://github.com/user-attachments/assets/2c1074aa-2ae5-47e1-9c47-7a284e62813b" />

- CAA (Certification Authority Authorization) DNS record specifies which Certificate Authorities (CAs) are allowed to issue SSL/TLS certificates for a domain.


##### 11.  DNSKEY / RRSIG – DNSSEC Records
````
dig google.com DNSKEY 
dig google.com RRSIG 
````
<img width="922" height="352" alt="image" src="https://github.com/user-attachments/assets/f2af3d3c-0045-4a05-a468-c714ac1f5a70" />

<img width="633" height="624" alt="image" src="https://github.com/user-attachments/assets/4e7eb58a-8249-4419-a076-f4969f93d7c5" />



#### 3. Short Answer Only
````
dig +short tesla.com
````
<img width="252" height="207" alt="image" src="https://github.com/user-attachments/assets/58fc5804-e6cc-4a0f-a588-dc9fa3b16027" />

- +short tells dig to:
   - Suppress headers, stats, question section, metadata.
   - Show only the answer data.
     

#### 4. Specify DNS Server
````
dig @8.8.8.8 tesla.com
````
<img width="579" height="526" alt="image" src="https://github.com/user-attachments/assets/965b802a-e098-46fc-961e-1d617312b40f" />

- This command use to Queries Google DNS instead of system’s default.


#### 5. Reverse DNS Lookup
````
dig -x 8.8.8.8
````
<img width="563" height="373" alt="image" src="https://github.com/user-attachments/assets/126bf912-bf57-4dd3-8f70-1b98bfef530e" />

- Finds the domain name for an IP address.


#### 6. Trace DNS Resolution
````
dig +trace tesla.com
````
<img width="1001" height="384" alt="image" src="https://github.com/user-attachments/assets/043c9893-9c15-4120-a07b-e53801b1480f" />

<img width="843" height="224" alt="image" src="https://github.com/user-attachments/assets/c9b0794e-0807-4abc-a1de-fbdc05adb22b" />

- This command is a powerful way to see how DNS resolution works step by step, from the root DNS servers all the way to the final answer.


#### 7. Get ALL Record
````
dig tesla.com ANY
````
<img width="556" height="355" alt="image" src="https://github.com/user-attachments/assets/3a41b60c-37fe-4877-b286-03fc160fda68" />

- ANY : is deprecated 
   - Modern DNS servers ignore or limit ANY queries.
   - It was abused in DNS amplification attacks (used in DDoS).
   - Many servers now return minimal or no data for ANY.
     

#### 8. Show Only Answer Section
````
dig tesla.com +noall +answer
````
<img width="528" height="221" alt="image" src="https://github.com/user-attachments/assets/71b2303f-b532-4825-92ea-3395dc0f5c5a" />

- noall : used to turn off all default output sections  giving a clean slate so you can selectively enable only the parts you want in the output.


#### 9. Check TTL (Time to Live)
````
dig tesla.com A +ttlunits
````
<img width="573" height="522" alt="image" src="https://github.com/user-attachments/assets/b354ac48-e83b-4b55-952e-4880642274a7" />

- +ttlunits : is a dig option that tells the tool to display TTL values using human-readable time units (like seconds, minutes, hours, days) instead of just raw seconds.


#### 10. Query Multiple Domains at Once
````
dig ababank.com google.com openai.com
````
<img width="594" height="725" alt="image" src="https://github.com/user-attachments/assets/9addc1ef-9f18-42c3-ad39-3134b8b60705" />

<img width="575" height="304" alt="image" src="https://github.com/user-attachments/assets/8ede6750-c6f6-4e8b-b238-bee2e7857eb2" />

- This command use for Queries several domains in one command.

#### 11. Custom Port
````
dig @8.8.8.8 -p 53 ababank.com
````
<img width="589" height="388" alt="image" src="https://github.com/user-attachments/assets/d8431c05-3bee-4956-82ce-2aae25418a98" />

- This command Useful if DNS server runs on a non-standard port.
- -p 53 : The correct DNS port.


#### 12. DNSSEC Info
````
dig tesla.com +dnssec
````
<img width="618" height="508" alt="image" src="https://github.com/user-attachments/assets/3d0a59fa-cda4-4693-a09e-81015d3713e9" />

-  DNSSEC(Domain Name System Security Extensions) is a security protocol designed to protect DNS queries from being tampered with, such as in DNS spoofing or cache poisoning attacks.


#### 13. Verbose Debug Mode
````
dig tesla.com +noall +answer +multiline
````
<img width="414" height="229" alt="image" src="https://github.com/user-attachments/assets/22ede573-56b4-4749-8178-a132eeb4a94f" />

- This command use to Shows records in a readable format.


#### 14. Query from a File
````
nano domain.txt
````
<img width="213" height="52" alt="image" src="https://github.com/user-attachments/assets/9353db89-63b0-41fc-86ed-b7566b318c5c" />

<img width="553" height="259" alt="image" src="https://github.com/user-attachments/assets/97b47b95-f817-4160-ada5-d0b907e3faa6" />


````
dig -f domain.txt
````
<img width="511" height="461" alt="image" src="https://github.com/user-attachments/assets/90903366-b017-41a0-a766-51c72fc243d7" />

<img width="512" height="491" alt="image" src="https://github.com/user-attachments/assets/0d0cae31-105c-458c-827c-3af8bb2766ef" />

- domains.txt contains a list of domains : bulk query.

## Script about dig:
This script was originally generated with the help of AI. I studied the output, customized it, and added my own improvements  

````
#!/usr/bin/env python3

import dns.resolver
import dns.reversename
import argparse
import sys

def query_dns(domain, record_type):
    """Perform DNS query for a given domain and record type."""
    try:
        answers = dns.resolver.resolve(domain, record_type)
        print(f"\n;; {record_type} records for {domain}")
        print(";; ANSWER SECTION:")
        for rdata in answers:
            if record_type == 'MX':
                print(f"{domain}.\tIN\t{record_type}\t{rdata.preference} {rdata.exchange}")
            elif record_type == 'TXT':
                txt_data = ' '.join([s.decode() for s in rdata.strings])
                print(f"{domain}.\tIN\t{record_type}\t\"{txt_data}\"")
            else:
                print(f"{domain}.\tIN\t{record_type}\t{rdata}")
    except dns.resolver.NoAnswer:
        print(f"\n;; No {record_type} record found for {domain}")
    except dns.resolver.NXDOMAIN:
        print(f"\n;; Domain {domain} does not exist")
    except dns.resolver.Timeout:
        print(f"\n;; Request timed out for {domain}")
    except Exception as e:
        print(f"\n;; Error querying {domain} for {record_type}: {str(e)}")

def reverse_lookup(ip):
    """Perform reverse DNS lookup (PTR)."""
    try:
        addr = dns.reversename.from_address(ip)
        result = dns.resolver.resolve(addr, "PTR")
        print(f"\n;; PTR record for {ip}")
        print(";; ANSWER SECTION:")
        for rdata in result:
            print(f"{ip}.\tIN\tPTR\t{rdata}")
    except Exception as e:
        print(f"\n;; No PTR record for {ip} or error: {str(e)}")

def main():
    parser = argparse.ArgumentParser(description="A Python 'dig'-like DNS lookup tool")
    parser.add_argument("domain", nargs="?", help="Domain to query (e.g., example.com)")
    parser.add_argument("-t", "--type", choices=["A", "AAAA", "MX", "NS", "TXT", "CNAME"], 
                        default="A", help="Record type to query (default: A)")
    parser.add_argument("--all", action="store_true", help="Query all common record types")
    parser.add_argument("--ptr", help="Perform reverse lookup on IP address")

    args = parser.parse_args()

    if not args.domain and not args.ptr and not args.all:
        print("Error: You must provide a domain or use --ptr.")
        parser.print_help()
        sys.exit(1)

    print(f"; <<>> Python DIG <<>>")
    print(f"; (using dnspython)")
    print(f"; global options: +cmd")

    if args.ptr:
        reverse_lookup(args.ptr)

    if args.domain:
        if args.all:
            for rtype in ["A", "AAAA", "MX", "NS", "TXT", "CNAME"]:
                query_dns(args.domain, rtype)
        else:
            query_dns(args.domain, args.type)

    print("\n;; Connection to DNS server succeeded. Queries complete.")

if __name__ == "__main__":
    main()
````
<img width="631" height="572" alt="image" src="https://github.com/user-attachments/assets/28bb3a7c-cc2e-4b05-ba9e-23851ebec0c8" />

This script i run in VSCode in kali, but if we run this script in VSCode in windows it maybe need to install some module.

##### We can run more script like:
````
/bin/python /home/k4n0ng/Documents/scanning/Scanning_Tools.py/dig.py -t MX tesla.com

/bin/python /home/k4n0ng/Documents/scanning/Scanning_Tools.py/dig.py tesla.com --all

/bin/python /home/k4n0ng/Documents/scanning/Scanning_Tools.py/dig.py -t AAAA google.com

/bin/python /home/k4n0ng/Documents/scanning/Scanning_Tools.py/dig.py --ptr 8.8.8.8
````

#### ==============>> End of dig

##### Usage in real world:
- Hackers / Red Team (offensive) : use dig during reconnaissance (information gathering) to enumerate DNS records, look for misconfigurations, or attempt zone transfers.
- Defenders / Blue Team (defensive) : use dig to troubleshoot DNS issues, check if records are resolving correctly, and validate security (DNSSEC, etc.).
- Penetration Testers / Bug Hunters : use it as part of a legal security assessment to map out infrastructure.

##### What attacker use this tool?
Attackers only use it in the first phase. It doesn’t hack anything by itself, it’s just asking DNS servers questions.



###  Practice in LAB By: Nin Kanong(k4n0ng)
#### Date: 25/Aug/2025
