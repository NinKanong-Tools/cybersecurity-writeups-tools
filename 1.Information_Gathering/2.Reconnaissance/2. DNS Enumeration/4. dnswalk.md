# dnswalk 

### What is dnswalk?
dnswalk is a DNS debugger and zone file linter that checks DNS zone files for syntax, consistency, and common configuration errors. It performs sanity checks on DNS data, including verifying NS records, resolving glue records, checking for missing A records (glue), and detecting anomalies like duplicate records or incorrect TTLs.

### LAB Tool
Kali Linux


### 1. Basic syntax

- Install dnswalk

````
dnswalk
````
<img width="663" height="229" alt="image" src="https://github.com/user-attachments/assets/884e774e-ddd2-4993-a5af-251777a68821" />


````
dnswalk oogle.com.
````
<img width="706" height="262" alt="image" src="https://github.com/user-attachments/assets/ddc75a55-e9ad-4104-b903-1bfd6daca90e" />

####Options:
Option	Meaning
-r :	Recursively descend sub-domains
-d : 	Debugging output
-i : 	Ignore invalid hostnames
-a :	Advanced checks (duplicate hosts, CNAME loops)
-F :	Donâ€™t check if A record is in delegated zone
-f :	Force run even if SOA is broken
-t : 	Trace delegation (follow NS)
-m :	Warn if MX host is a CNAME
-M :	Suppress warnings about MX â†’ CNAME
-s :	Query all NS servers (secondary checks)
-v :	Verbose mode


### 2. Recursive Check
````
dnswalk -r google.com
````
<img width="658" height="252" alt="image" src="https://github.com/user-attachments/assets/537f778d-95e3-49b9-8c69-550c68df7168" />

- -r : tells dnswalk not to recurse into subdomains.


### 3. Advanced Checks (CNAME Loops, Duplicates)
````
dnswalk -a facebook.com
````
<img width="638" height="158" alt="image" src="https://github.com/user-attachments/assets/9c653f75-f013-4003-900a-65a860592020" />

- -a :	Advanced checks.

### 4. Debug Mode
````
dnswalk -d google.com
````
<img width="673" height="255" alt="image" src="https://github.com/user-attachments/assets/e32f6680-6294-4188-83f9-df3b83e5dfb7" />

### 5. Trace Delegation
````
dnswalk -t google.com.
````
<img width="632" height="279" alt="image" src="https://github.com/user-attachments/assets/841a4acd-66e0-448f-bcaa-3baa4adf8d1b" />


### 6. Ignore Invalid Hostnames
````
dnswalk -i google.com.
````
<img width="660" height="255" alt="image" src="https://github.com/user-attachments/assets/9cef4a2f-a539-48af-81e2-17d1040d5fef" />


### 7. MX Host Checks
````
dnswalk -m google.com.
````
<img width="676" height="253" alt="image" src="https://github.com/user-attachments/assets/7db8efef-9e6b-4f27-98cf-324747c215c0" />


### 8. Verbose Mode
````
dnswalk -v google.com.
````
<img width="662" height="264" alt="image" src="https://github.com/user-attachments/assets/09fc94e1-7ab5-4a79-be8c-88352237f505" />


#### This my dnswalk in kali is old version, result will the same


### Python Script about dnswalk

````
#!/usr/bin/env python3

import dns.resolver
import dns.reversename
import dns.zone
import dns.query
import sys
import socket

def query_nameservers(domain):
    """Get authoritative name servers for the domain."""
    try:
        ns_records = dns.resolver.resolve(domain, 'NS')
        return [str(ns.target) for ns in ns_records]
    except Exception as e:
        print(f"ERROR: Could not resolve NS records for {domain}: {e}")
        return []

def get_soa_nameserver(domain):
    """Get one name server from SOA (often authoritative)."""
    try:
        soa = dns.resolver.resolve(domain, 'SOA')
        mname = soa[0].mname 
        return str(mname)
    except:
        return None

def attempt_axfr(domain, ns):
    """Attempt zone transfer from a given nameserver."""
    try:
        z = dns.zone.from_xfr(dns.query.xfr(ns, domain))
        print(f" AXFR SUCCESS: from {ns}")
        return z
    except Exception as e:
        print(f" AXFR FAILED: from {ns} -> {e}")
        return None

def validate_glue_records(ns_list):
    """Check if NS hosts have A records (glue)."""
    errors = 0
    for ns in ns_list:
        ns = ns.rstrip('.') 
        try:
            addr = socket.gethostbyname(ns)
            print(f" Glue OK: {ns} -> {addr}")
        except socket.gaierror:
            try:
                a_record = dns.resolver.resolve(ns, 'A')
                print(f"   A Record OK: {ns} -> {a_record[0]}")
            except:
                print(f"  ERROR: No A record for nameserver {ns}")
                errors += 1
    return errors

def validate_mx_records(domain):
    """Check if MX records point to valid hosts."""
    errors = 0
    try:
        mx_records = dns.resolver.resolve(domain, 'MX')
        for mx in mx_records:
            host = str(mx.exchange).rstrip('.')
            try:
                dns.resolver.resolve(host, 'A')
                print(f"   MX OK: {host}")
            except:
                print(f"   ERROR: MX host unreachable: {host}")
                errors += 1
    except:
        print("    WARNING: No MX record found.")
    return errors

def main(domain):
    if not domain.endswith('.'):
        print("  Domain should end with a '.' (FQDN). Adding it automatically.")
        domain = domain + '.'

    domain = domain.lower()

    print(f"\n Starting DNS check for: {domain}")
    print("-" * 50)

    print(f" Querying NS records for {domain}...")
    ns_list = query_nameservers(domain)
    if not ns_list:
        print("FATAL: No authoritative name servers found!")
        sys.exit(1)

    for ns in ns_list:
        print(f" NS: {ns}")

    # Step 2: Attempt AXFR
    print("\n Attempting zone transfer (AXFR)...")
    zone = None
    for ns in ns_list:
        ip = None
        try:
            ip = socket.gethostbyname(ns)
        except:
            print(f"  Can't resolve NS IP: {ns}")
            continue
        zone = attempt_axfr(domain, ip)
        if zone:
            break

    if not zone:
        fallback_ns = get_soa_nameserver(domain)
        if fallback_ns:
            try:
                ip = socket.gethostbyname(fallback_ns)
                print(f" Trying AXFR from SOA master: {fallback_ns} ({ip})")
                zone = attempt_axfr(domain, ip)
            except:
                pass

    if not zone:
        print(" AXFR failed. Falling back to record-by-record validation.\n")

    print("ðŸ”§Checking glue records (A records for name servers)...")
    glue_errors = validate_glue_records(ns_list)

    print("\n Checking MX records...")
    mx_errors = validate_mx_records(domain)

    print("\n" + "="*50)
    print(" FINAL REPORT")
    print("="*50)
    print(f"Domain: {domain}")
    print(f"AXFR: {'Success' if zone else 'Failed (expected for public domains)'}")
    print(f"Name Servers: {len(ns_list)} found")
    print(f"Errors: {glue_errors + mx_errors}")
    if glue_errors == 0 and mx_errors == 0:
        print(" STATUS: No serious DNS problems found.")
    else:
        print("STATUS: DNS configuration has issues.")
    print("="*50)

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print(f"Usage: {sys.argv[0]} <domain>")
        print("Example: python3 {sys.argv[0]} example.com.")
        sys.exit(1)

    domain = sys.argv[1]
    main(domain)
````
<img width="728" height="610" alt="image" src="https://github.com/user-attachments/assets/2d6b3c8b-dd02-44fe-b4f6-78032f21c9af" />

<img width="499" height="157" alt="image" src="https://github.com/user-attachments/assets/8043848b-9482-4ac0-80cf-199455965564" />


This script i use AI to assist to get more detail than tool.

#### In real world pentesters use dnswalk to check for misconfigurations in DNS zones during information gathering.


#### ==========>> End of dnswalk


### Practice in LAB by: Nin Kanong(k4n0ng)

#### Date: 25/Aug/2025
