# Nmap Host Discovery

Nmap has become one of the most popular tools in network scanning by leaving other scanners behind. Many times, network administrators secure hosts in some organizations using firewalls or intrusion prevention systems. However, these security measures can sometimes block scanning attempts due to the preset rules used to filter network traffic. In Nmap, a pentester can easily make use of alternate host discovery techniques to prevent this from happening. It consists of certain features that make the network traffic a little less suspicious. Hence, let us look at various techniques of Host Discovery.

* this IP is my metaploit IP ( 192.168.100.102)

Table of Content

    Ping Sweep ( No port scan)
    Disable-arp-ping
    Send-ip
    TCP Flags
    Types of Scans
    TCP SYN Ping Scan
    TCP ACK Ping Scan
    ICMP ECHO Ping Scan
    ICMP ECHO Ping Sweep
    UDP Ping Scan
    IP Protocol Ping scan
    ARP Ping Scan
    Traceroute

## 1. Ping Sweep

```
nmap -sn 192.168.100.102
nmap -sn 192.168.100.0/24
```

<img width="657" height="519" alt="image" src="https://github.com/user-attachments/assets/6cea4e40-d880-4bd8-975a-e2f61bf084d8" />


- Performs host discovery without port scanning.
-  Sends ICMP Echo, TCP SYN to port 443, and TCP ACK to port 80 by default to find live hosts.

 ```
 nmap -sP 192.168.100.0/24
```

<img width="666" height="401" alt="image" src="https://github.com/user-attachments/assets/1d9f3b6e-24a4-41d0-bff1-cc8a77266d5a" />

When you closely observe the packets in Wireshark, you will notice that network scans send only ARP packets.

<img width="728" height="355" alt="image" src="https://github.com/user-attachments/assets/886dca85-7a03-4809-99c6-e46f6ecf2ff6" />

Note: Working of –sP and –sn is the same.

Let us try the same by using the no port scanning (-sn) option. In this option, we are also using –packet-trace option which will enable you to see the detailed packet transfer without making use of Wireshark. Here you can observe the ARP packets being received.

```
nmap -sn 192.168.100.0/24 --packet-trace
```
<img width="766" height="659" alt="image" src="https://github.com/user-attachments/assets/77341894-95ea-447b-aecc-75ef24ec1a3f" />

Now that we have identified ARP packets in the network, we can use the –disable-arp-ping option. In this case, you will observe that four packets are sent instead.


## 2. Disable-arp-ping

To disable the ARP discovery, Nmap provides this option.

```
nmap -sn 192.168.100.102 --disable-arp-ping
```

<img width="657" height="125" alt="image" src="https://github.com/user-attachments/assets/8c0dd06a-0766-4aac-9933-6c22faf992df" />

And you will see that the ARP packets are not visible

<img width="895" height="587" alt="image" src="https://github.com/user-attachments/assets/2a8d4874-ac5f-4d48-b011-03a07aac0a26" />

You can also make use of –send-ip option to get the same results as in the step above.

Note: When you scan the Local Network with Nmap, Nmap sends an ARP packet with every scan. If you scan an external network, Nmap sends the following request packets when –disable-arp-ping is used:

```
ICMP echo request (Type 8)
ICMP timestamp request (Type 13)
TCP SYN to port 443
TCP ACK to port 80
```


## 3. send-ip

```
nmap -sn 192.168.100.102 --packet-trace --send-ip
```

<img width="879" height="321" alt="image" src="https://github.com/user-attachments/assets/9d427421-4219-40f4-9e2b-f97ee4bb48f5" />

Host Discovery is the most fundamental step in Information Gathering. It provides accurate results regarding active ports and IP addresses in a network.


## 4. TCP Flags

First, let’s get to know the basics about the communication Flags in TCP. The TCP header mainly consists of six flags that manage the connection between the systems and provide instructions to them. Each flag is of 1 bit and hence the size of TCP Flags is 6 bits. Now let us briefly understand each flag.

<img width="369" height="222" alt="image" src="https://github.com/user-attachments/assets/418bbe30-53b5-4113-9343-cbc455029f5c" />

Types of Scans
To discover the hosts in the network, various ping scan methods can be used.

<img width="765" height="500" alt="image" src="https://github.com/user-attachments/assets/b19e2178-4453-4b7b-af11-0e1d93ea3f49" />


## 5. TCP SYN Ping Scan

It is a method of host discovery which helps in looking for discovering if the ports are open and to also make sure if it matches the rules of the firewall. The Pentester can hence, send an empty SYN flag to the target to check where it is alive. Multiple ports can be defined in this scan type.

<img width="677" height="362" alt="image" src="https://github.com/user-attachments/assets/b38749bd-ea08-4eb4-a127-d1ebdc0236fb" />

The -sP command in Nmap is specifically designed for discovering online hosts. On the other hand, the SYN Ping (-PS) command sends a TCP SYN packet to specific ports. If the port is closed, the host responds with an RST packet. If the requested ports are open, the host replies with a TCP SYN/ACK, followed by a reset packet to terminate the connection.

```
nmap -sn -PS 192.168.100.102 --disable-arp-ping
```

<img width="652" height="130" alt="image" src="https://github.com/user-attachments/assets/9f5e0841-eabe-43fa-af4f-63772a5cc5bc" />

The packets captured using Wireshark can be overserved

<img width="902" height="373" alt="image" src="https://github.com/user-attachments/assets/623f755c-064b-40fc-acac-1c895c8ca6f6" />

The advantage of TCP SYN Ping scan is that the pentester can get the active/inactive status of the host without even creating a connection and hence it does not even create a log in the system or the network.


## 6. TCP ACK Ping Scan

It is a method of host discovery that is similar to TCP SYN Ping scan, but it slightly differs. This scan also makes use of Port 80. The pentester sends an empty TCP packet to the target, and as there is no connection between them, it will receive an Acknowledgement packet and will then reset and terminate the request

<img width="747" height="388" alt="image" src="https://github.com/user-attachments/assets/d83eba47-d707-4d19-aef7-86dc0cef5ac9" />

Additionally, this command helps to determine how the target responds. It also checks if firewalls block the SYN packets or ICMP echo requests, as is common with many modern firewalls.

```
nmap -sn -PA 192.168.100.102 --disable-arp-ping
```
<img width="658" height="130" alt="image" src="https://github.com/user-attachments/assets/22e34d63-5834-4898-a90c-7f61f1bc5dc5" />

You can observe the captured packets in Wireshark here.

<img width="904" height="373" alt="image" src="https://github.com/user-attachments/assets/fe55b671-440d-461d-b2d3-9629e6e4f6fc" />

This scan might work to get past the firewall in this situation because some systems set up firewalls to prevent SYN ping packets.




## 7. No Ping Scan
In this method, host discovery is completely skipped. The pentester can use it to determine active machines for heavier scanning and to increase the speed of the network.

```
nmap -Pn 192.168.100.102
```

<img width="652" height="509" alt="image" src="https://github.com/user-attachments/assets/5859ea34-e0ca-42e6-a0d3-4b31ce9b1e54" />

Skips host discovery entirely and assumes all target hosts are online. Proceeds directly to port scanning or other tasks.

```
nmap -sn -PN 192.168.1.108 --disable-arp-ping
```
<img width="534" height="108" alt="image" src="https://github.com/user-attachments/assets/abfae7b1-806f-40ce-bdf2-bea913376ca9" />


## 8. List Scan
```
nmap -sL 192.168.100.102
nmap -sL 192.168.100.102
```

<img width="527" height="338" alt="image" src="https://github.com/user-attachments/assets/2a21c4f2-bf6e-4749-99b6-f09d0e1584fe" />

## 9. ICMP Echo Request or ICMP Echo ping scan

The ICMP Ping scan gathers information about target systems, making it distinct from port scanning. The pentester sends an ICMP ECHO request to the target and receives an ICMP ECHO reply in response.

<img width="817" height="295" alt="image" src="https://github.com/user-attachments/assets/d042ecc0-f833-4e3c-a0ed-38bb11e80cb7" />

```
nmap -sn -PE 192.168.100.102
```

<img width="655" height="127" alt="image" src="https://github.com/user-attachments/assets/e14b8aff-dd8a-42a4-b178-6b84cded556f" />

Sends ICMP Type 8 (echo request) packets, like a standard "ping."

```
nmap -sn -PE 192.168.100.102 --disable-arp-ping
```
<img width="661" height="127" alt="image" src="https://github.com/user-attachments/assets/565f36f2-4e27-4bff-b1b1-390a9d806b71" />

The packets captured in Wireshark can be observed.

<img width="909" height="376" alt="image" src="https://github.com/user-attachments/assets/4182930b-5ff0-41ce-9e95-ad89f56813b4" />




## 10. ICMP Timestamp Request

The pentester can adopt this technique in a particular condition when the system admin blocks the regular ICMP timestamp. It is usually used in synchronization of time.

```
nmap -sn -PP 192.168.100.102
nmap -sn -PP 192.168.100.1/24

```
<img width="652" height="423" alt="image" src="https://github.com/user-attachments/assets/b9d06588-ae6e-465b-8de7-903618d05fc2" />

Sends ICMP Type 13 (timestamp request) packets to check if a host responds.
```
nmap -sn -PP 192.168.100.102 --disable-arp-ping
```
<img width="658" height="133" alt="image" src="https://github.com/user-attachments/assets/11fc1295-2a2f-49f9-8d60-c0f0ce163aa8" />

The packets captured using Wireshark can be observed.

<img width="896" height="371" alt="image" src="https://github.com/user-attachments/assets/39fd29b6-b9ee-41f6-a253-e3bc018e13c6" />


## 11. ICMP Address Mask Request (-PM)

It is an older method of ICMP ECHO ping scanning. It gives out the information about the system and its subnet mask.

```
nmap -sn -PM 192.168.100.102
```

<img width="653" height="127" alt="image" src="https://github.com/user-attachments/assets/c13c0ff4-f6da-4313-855a-c976568681b9" />

Sends ICMP Type 17 (address mask request) packets to elicit subnet mask replies.



## 12. TCP SYN Ping (-PS[port_list])
```
nmap -sn -PS22,80,443 192.168.100.102
nmap -sn _PS22,80,443 192.168.100.1/24
```


<img width="653" height="331" alt="image" src="https://github.com/user-attachments/assets/a5b154a8-23d5-4084-97ce-1fdaeb86236c" />

Sends TCP SYN packets to specified ports (default: 80, 443) to check for responses.


## 13. TCP ACK Ping (-PA[port_list])
```
nmap -sn -PA 192.168.100.102
nmap -sn -PA22,80,443 192.168.100.102
```

<img width="658" height="256" alt="image" src="https://github.com/user-attachments/assets/def9e30e-3f5c-48d6-9965-c9e65fe9228e" />

Sends TCP ACK packets to specified ports (default: 80, 443) to elicit RST responses.


## 14. UDP Ping (-PU[port_list])
The UDP Ping Scans uses a highly uncommon default port number 40125 to send packets to the target. It is similar to TCP Ping scan. The Pentester will send the UDP Packets to the target and if there is a response in return, which means that the host is alive, or else it is offline.

```
nmap -sn -PU 192.168.100.102
nmap -sn -PU53,161 192.168.100.102
```

<img width="658" height="256" alt="image" src="https://github.com/user-attachments/assets/23410522-6129-4a4d-8f95-315d73034713" />

Sends UDP packets to specified ports (default: 40125) to check for responses.

<img width="610" height="657" alt="image" src="https://github.com/user-attachments/assets/2ea60e63-f52a-4e2b-ad9b-2729e9c8cf36" />

<img width="610" height="657" alt="image" src="https://github.com/user-attachments/assets/83c6a6d1-1f53-4e19-92df-4d5e66730ad9" />

The advantage of UDP scan is that it can detect systems that have firewalls with strict TCP rules while leaving UDP rules at ease.

```
nmap -sn -PU 192.168.100.102 --disable-arp-ping
```

<img width="658" height="130" alt="image" src="https://github.com/user-attachments/assets/e0e9f35f-ac71-42fe-bafe-218f9378aacd" />

You can observe the packets sent using Wireshark.

<img width="900" height="412" alt="image" src="https://github.com/user-attachments/assets/fb16169f-2566-441e-aea0-210d7b97a5ec" />


## 15. IP protocol ping scan
In this method, the pentester sends various packets using different IP protocols and hopes to get a response in return if the target is alive.

<img width="777" height="405" alt="image" src="https://github.com/user-attachments/assets/f7ea46db-8c1d-49d0-a63b-702e29389dd6" />

```
nmap -sn -PO 192.168.100.102 --disable-arp-ping
```

<img width="650" height="140" alt="image" src="https://github.com/user-attachments/assets/f978d9a6-25da-4062-9db1-6830bf8d7e8c" />

The packets captured can be observed using Wireshark.

<img width="902" height="369" alt="image" src="https://github.com/user-attachments/assets/d86e5ff1-8d1c-4cff-9ed9-c75a40b9de3e" />


## 16. ARP ping scan
In this method, the system sends ARP packets to all the devices in the network, even though these devices remain invisible due to the firewall. ARP ping scans are generally considered more efficient than other host discovery methods. Moreover, they primarily focus on system discovery and also provide latency details.

<img width="691" height="366" alt="image" src="https://github.com/user-attachments/assets/77daf674-65c8-4a69-9ad9-7378d038d8d5" />

```
nmap -sn -PR 192.168.100.102
```

<img width="651" height="128" alt="image" src="https://github.com/user-attachments/assets/a4df7d31-7e1a-43ca-b543-8de5a5d2fc23" />

You can see the packets being captured in Wireshark.

```
ip.addr == 192.168.100.102 || arp
```
<img width="908" height="341" alt="image" src="https://github.com/user-attachments/assets/efc0c0bf-a693-4f50-8728-998f43d5ee61" />



## 17. SCTP INIT Ping (-PY[port_list])
It sends SCTP packet containing a minimal INIT chunk. Its default destination port is 80. The INIT chunk provides a suggestion to the remote system that the pentester is attempting to establish an association.

```
nmap -sn -PY 192.168.100.102 --disable-arp-ping
```

<img width="661" height="138" alt="image" src="https://github.com/user-attachments/assets/a13ca4df-69a1-4e03-a5af-c03d4760a449" />

The packets that are captured can be observed.

```
ip.addr == 192.168.100.102
```

<img width="906" height="375" alt="image" src="https://github.com/user-attachments/assets/60602e89-64ad-437b-a20a-8542c02f800a" />


## 18. Traceroute
Users typically perform traceroutes after finishing a scan. At this stage, you can leverage the information from the scan results to determine the port and protocol that will reach the target.

```
nmap -sn --traceroute 8.8.8.8
```

<img width="518" height="296" alt="image" src="https://github.com/user-attachments/assets/44069201-b857-4df2-be38-df0c85bf1e0f" />

```
nmap -sn --traceroute 192.168.100.102
```

<img width="654" height="204" alt="image" src="https://github.com/user-attachments/assets/cf4d4724-0797-4b7f-be1b-b32e0ff8ff5e" />


=============>>> End of Host Discovery

## Refference:

1. https://www.hackingarticles.in/nmap-for-pentester-host-discovery/
2. https://www.udemy.com/course/top-course/learn/lecture/38870762#overview
3. https://salacyber.com

## Practise in LAB by: Nin Kanong(k4n0ng)
