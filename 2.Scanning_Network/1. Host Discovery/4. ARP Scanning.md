# ARP Scanning

<img width="524" height="236" alt="1_x5HUKMrfgdBxg_TqBkNa_Q" src="https://github.com/user-attachments/assets/681976a9-23cf-4194-ae88-33988b278455" />

### What is ARP Scanning?
ARP (Address Resolution Protocol) scanning is a method to discover devices on a local network by sending ARP requests and collecting responses. It operates at Layer 2 (Data Link Layer) of the OSI model, mapping IP addresses to MAC addresses.


### LAB Tools
- Kali Linux
- Ubuntu(wireshark)
- metasploitable2


### 1. Installation
````
sudo apt install arp-scan
````
<img width="751" height="220" alt="image" src="https://github.com/user-attachments/assets/655febbb-56b0-4e85-a754-33c9906ecb16" />

Somehow this tool it already have in kali.

- Check verify:
````
arp-scan --version
````
<img width="634" height="189" alt="image" src="https://github.com/user-attachments/assets/92ded106-18ba-4184-ac84-f430e9eb158d" />


````
sudo wiresahrk
````
<img width="821" height="644" alt="image" src="https://github.com/user-attachments/assets/7a442f4f-8f46-4dc8-9659-a02251b4e5e9" />



## Basic ARP Scanning and Wireshark Analysis
````
arp-scan 192.168.127.0/24
````
<img width="752" height="246" alt="image" src="https://github.com/user-attachments/assets/8ae38665-3aff-4fe7-882d-dbda1e6819c8" />

### 1. Perform a Basic ARP Scan
#### Run arp-scan:
````
sudo arp-scan --interface=eth0 --localnet
````
<img width="730" height="198" alt="image" src="https://github.com/user-attachments/assets/d96b9d97-d28c-4adc-ac04-52987a2c0e78" />

- wireshark
<img width="964" height="528" alt="image" src="https://github.com/user-attachments/assets/200aedf4-9014-45e5-b103-171adaf3547c" />

192.168.127.128 is my kali IP 

#### 2. Save Results:
````
sudo get-oui
sudo arp-scan --interface=eth0 192.168.127.131 > scan.txt
cat scan.txt
````
<img width="722" height="403" alt="image" src="https://github.com/user-attachments/assets/c13a35b1-930f-4136-91b5-c2b13f526f9b" />

- wireshark
<img width="922" height="564" alt="image" src="https://github.com/user-attachments/assets/4964e997-5b44-42f6-a0b0-2294e0669133" />



## ARP Scanning and Wireshark Techniques
### 1. Targeted Scanning
#### 1. Scan Specific IP Range:
````
sudo arp-scan --interface=eth0 192.168.127.1-192.168.127.135
sudo arp-scan -I eth0 192.168.127.1-192.168.127.135
````
<img width="717" height="215" alt="image" src="https://github.com/user-attachments/assets/72d7c6ec-51df-48e9-afa1-394797c776a3" />

<img width="740" height="216" alt="image" src="https://github.com/user-attachments/assets/557f7cc3-5b82-4363-a78e-74119627d2b1" />

- Scans only IPs from 192.168.1.1 to 192.168.1.50.

#### 2. Wireshark Filter:

<img width="896" height="548" alt="image" src="https://github.com/user-attachments/assets/543d553a-5f01-44a2-b943-87c65c9f130b" />


### 2. Quiet and Script-Friendly Output
#### 1. Run arp-scan in Quiet Mode:
````
sudo arp-scan --quiet --interface=eth0 192.168.127.129 > devices.txt
cat devices.txt
````
<img width="711" height="211" alt="image" src="https://github.com/user-attachments/assets/2f573f77-7115-4283-a457-6e99a2c58cdd" />

#### 2. Wireshark Analysis
<img width="909" height="533" alt="image" src="https://github.com/user-attachments/assets/b7438b75-c247-41b9-94d0-be4cdb2605bf" />


### 3. Adjust Scan Speed
#### 1. Slow Scan to Avoid Detection:
````
sudo arp-scan --rate=10 --interface=eth0 192.168.127.0/24
sudo arp-scan --interface=eth0 --localnet
````
<img width="745" height="229" alt="image" src="https://github.com/user-attachments/assets/c437d8a2-6ba6-41ba-b786-7196c5981999" />

<img width="736" height="224" alt="image" src="https://github.com/user-attachments/assets/1cdcb6c2-9090-444a-bdc8-4cf1721fa06d" />

- Two of this we can use it the same.

- wireshark
<img width="905" height="568" alt="image" src="https://github.com/user-attachments/assets/fe61bb72-f5c0-4db7-8e09-397413536207" />

- `--interface=eth0` : specifies which NIC to use (yours is eth0; in some setups it may be ens33, wlan0, etc.).
- `--localnet` : automatically detects your local subnet (reads from your interface config).


### 2. Resolve Hostnames
#### 1.Run arp-scan with Hostname Resolution:
````
sudo arp-scan --resolve --interface=eth0 --localnet
````
<img width="769" height="226" alt="image" src="https://github.com/user-attachments/assets/074e6c54-7c4f-4e98-b49a-7719e66425be" />

- Wireshark
<img width="902" height="448" alt="image" src="https://github.com/user-attachments/assets/9e484ab3-ead8-4c12-84ee-41664b6ec399" />

- No direct hostname in ARP packets, but use Wireshark’s “Statistics > Resolved Addresses” to map IPs to names.
- `--resolve` : after finding a host’s MAC address, it will also resolve the vendor/manufacturer (using the IEEE OUI database).

##### Feed directly into Nmap for deeper scan:
````
sudo arp-scan --interface=eth0 --localnet --quiet | awk '{print $1}' | grep -Eo '([0-9]+\.[0-9]+\.[0-9]+\.[0-9]+)' > hosts.txt
````
<img width="897" height="221" alt="image" src="https://github.com/user-attachments/assets/6e896487-f826-48e1-bec5-521d0909a1ca" />

````
nmap -sV -iL hosts.txt -oN nmap_results.txt
````
<img width="908" height="802" alt="image" src="https://github.com/user-attachments/assets/6f827f94-f54a-4d5a-9fd3-d696f528e5d8" />

<img width="779" height="147" alt="image" src="https://github.com/user-attachments/assets/7f7978d8-5634-4f24-b27b-6a7cadee9ef9" />

- arp-scan finds the hosts, then nmap scans services.

- Wireshark
<img width="906" height="596" alt="image" src="https://github.com/user-attachments/assets/13f19c00-c54e-43b6-80ef-26af8c32dc6d" />

<img width="893" height="627" alt="image" src="https://github.com/user-attachments/assets/6302522d-102a-4456-8697-5bb30e62a15c" />

- This Wireshark capture shows a successful HTTP session from .128 to a web server running on .129:8180 plus normal background NetBIOS/MDNS noise.


## ARP Scanning and Wireshark Analysis
### 1. Spoof Source IP/MAC
#### 1. Spoof Source IP:
````
sudo arp-scan --arpspa=192.168.127.129 --interface=eth0 --localnet
````
<img width="758" height="227" alt="image" src="https://github.com/user-attachments/assets/9fa65849-1fe4-43f1-bb2e-c54d02a426dd" />
- `--arpspa=192.168.127.129` This sets the Sender Protocol Address (SPA) field in the ARP packet.
- ARP requests appear to come from 192.168.127.129.

#### 2. Spoof Source MAC:
````
sudo arp-scan --srcaddr=00:0C:29:0A:46:C1 --interface=eth0 --localnet
````
<img width="751" height="246" alt="image" src="https://github.com/user-attachments/assets/b3469ed9-982d-4704-81f1-fd8157ecd410" />

- `--srcaddr=00:0C:29:0A:46:C1` : This option forges the source MAC address in the Ethernet frame. Normally, your NIC’s real MAC (say 00:0c:29:12:34:56) is used. With this flag, you’re pretending to be another device at Layer 2.

- Wireshark
<img width="904" height="479" alt="image" src="https://github.com/user-attachments/assets/b4d3ed72-0ff9-446d-95da-8956290ea424" />

- In this it verify packets show spoofed IP/MAC in ARP and Ethernet headers.


### 2. Save Packets for Analysis
#### 1. arp-scan with PCAP Output:
````
sudo arp-scan --pcapsavefile=/tmp/arp_scan.pcap --interface=eth0 --localnet
````
<img width="733" height="238" alt="image" src="https://github.com/user-attachments/assets/3fef89c2-0939-4bbd-852b-fe587fa9539b" />

- Wireshark
<img width="908" height="475" alt="image" src="https://github.com/user-attachments/assets/2d98a314-5c3e-4235-b301-969f8e6f0885" />

- filter and analyze packets.


### 2. Detect ARP Spoofing
#### 1. Run Continuous arp-scan:
````
sudo arp-scan --interval=60 --interface=eth0 --localnet
````
<img width="731" height="240" alt="image" src="https://github.com/user-attachments/assets/e0d11e8a-ca91-4be6-acc7-09416716345b" />

- `--interval=60` : waits 60 seconds between sending each ARP packet.
- Scans every 60 seconds to monitor changes.


#### 2. Wireshark Filter for Spoofing:
````
arp.duplicate-address-detected
````
<img width="914" height="495" alt="image" src="https://github.com/user-attachments/assets/91d7aa72-d401-4caf-b8d8-f0edd32bfa66" />

- Look for multiple MACs replying for the same IP.
- Identifying man-in-the-middle attacks in a corporate network.


## Python script
````
#!/usr/bin/env python3

"""
ARP Scanner Script
Author: Assistant
Description: Scans the local network using ARP requests to find active devices.
Usage: Run with sudo privileges.
"""

from scapy.all import ARP, Ether, srp
import sys

def arp_scan(target_ip):
    """
    Perform an ARP scan on the given target IP range.
    :param target_ip: IP range in CIDR notation (e.g., '192.168.1.0/24')
    """
    print(f"[+] Sending ARP requests to {target_ip}...")
    
    arp = ARP(pdst=target_ip)
    ether = Ether(dst="ff:ff:ff:ff:ff:ff")
    packet = ether / arp

    result = srp(packet, timeout=3, verbose=0)[0]

    clients = []
    for sent, received in result:
        clients.append({'ip': received.psrc, 'mac': received.hwsrc})

    return clients

def main():
    if len(sys.argv) != 2:
        print(f"Usage: sudo {sys.argv[0]} <IP_RANGE>")
        print("Example: sudo python3 arp_scan.py 192.168.1.0/24")
        sys.exit(1)

    target_ip = sys.argv[1]

    print("[*] Starting ARP Scan...\n")
    clients = arp_scan(target_ip)

    print("Available devices in the network:")
    print("IP" + " " * 18 + "MAC")
    print("-" * 40)
    for client in clients:
        print(f"{client['ip']:<16}  {client['mac']}")

    print(f"\n[+] Scan complete. Found {len(clients)} device(s).")

if __name__ == "__main__":
    main()
````
<img width="597" height="356" alt="image" src="https://github.com/user-attachments/assets/1768ede5-a03c-4601-8e5b-72c306ab38f3" />

- I use AI to assists about this script to make it easy to understand.

## Note: We can replace --interface=eth0 by eth0.

### ===========>>> End of arp-scan

### Why Hacker use this tool:
Hackers (and penetration testers / red teamers) use arp-scan and similar tools because ARP scanning is one of the fastest and most reliable ways to discover devices on a local network.
- Host discovery (network mapping)
- MAC address identification
- Finding hidden devices
- Pivoting & lateral movement
- Reconnaissance before attacks


### Credit
1. https://www.hackercoolmagazine.com/beginners-guide-to-arp-scan/?srsltid=AfmBOorjXqq4Ys1_eXlbAt4Ra3KpltuP9T5dtSXKrqg9W69ZthMFYn-t
2. https://www.hackingloops.com/arp-scans/

### Practice in LAB BY: Nin Kanong(k4n0ng)
#### Date: 29/Aug/2025
