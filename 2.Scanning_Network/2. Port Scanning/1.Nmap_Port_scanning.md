# Nmap Port Scanning

<img width="1536" height="803" alt="Nmap-1536x803" src="https://github.com/user-attachments/assets/8eaf9a59-abeb-4ea0-b2bd-0d8326a8b50d" />

### What is nmap?
A basic Nmap scan identifies live hosts, open ports, and sometimes basic service information on a target IP or hostname. These scans are lightweight and suitable for beginners to understand network reconnaissance.

### LAB Tools
- Kali Linux (192.168.127.128)
- Ubuntu (192.168.127.131)
- Metasploitable2 (192.168.127.129)
- I use wireshark in ubuntu to filter traffic.


## Usages 


### 1. Basic Nmap Scan against IP or hos
- Scan specific IP
````
nmap 192.168.127.129
````
<img width="667" height="172" alt="image" src="https://github.com/user-attachments/assets/a82fe792-0bae-4f4f-b006-bea944b8c803" />

- Scan hostname:
````
nmap nmap.org
````
<img width="540" height="185" alt="image" src="https://github.com/user-attachments/assets/d154b09f-a92d-4bf3-a205-b2f858b0ed6e" />


- In wireshark:
````
icmp || arp || (tcp && ip.dst == 192.168.127.129)
````
<img width="905" height="486" alt="image" src="https://github.com/user-attachments/assets/1629575d-489f-4257-9a0a-11ed6743dd4b" />


### 2. Nmap Ping Scan
````
nmap -sp 192.168.127.129
````
<img width="884" height="134" alt="image" src="https://github.com/user-attachments/assets/43d29b24-be81-404e-a991-b328a74695ee" />


- Wireshark:
````
icmp || arp || (tcp && ip.dst == 192.168.127.129)
````
<img width="906" height="477" alt="image" src="https://github.com/user-attachments/assets/0157f3c3-674a-4d37-824b-5bf8230e9194" />

- `-sn` : Performs a host discovery scan (ping sweep) without port scanning.


### 3. Scan specific ports or scan entire port ranges on a local or remote server
````
nmap -p 1-65535 localhost
````
<img width="531" height="208" alt="image" src="https://github.com/user-attachments/assets/75800df9-22ce-4cdd-ae66-ed460098dcea" />

- `-p 1-65535` : Scans all TCP ports (1 to 65,535).
- `localhost` : Targets the loopback address (127.0.0.1), like our own machine.
- we scanned all 65535 ports for our localhost computer.

- Wireshark
````
tcp && ip.dst == 127.0.0.1
````
<img width="919" height="466" alt="image" src="https://github.com/user-attachments/assets/b49f28ab-7c8a-455d-95a8-84df4c8d5299" />

- this my localhost
<img width="616" height="558" alt="image" src="https://github.com/user-attachments/assets/24d37a02-026a-424b-9828-ddbdb019caaa" />



### 4. Scan multiple IP addresses
````
nmap 192.168.127.128 192.168.127.129
````
<img width="551" height="176" alt="image" src="https://github.com/user-attachments/assets/0666de9d-6020-44a8-9829-249b17218f08" />

````
nmap 192.168.127.128,129,131
````
<img width="606" height="207" alt="image" src="https://github.com/user-attachments/assets/562d2262-5251-4f61-8fb8-5ad505f8a0cc" />

- Scans the top 1000 TCP ports on each of the three IPs.

- Wireshark
````
ip.addr == 192.168.127.128 || ip.addr == 192.168.127.129 || ip.addr == 192.168.127.131
````
<img width="903" height="544" alt="image" src="https://github.com/user-attachments/assets/5c5f3729-e47d-4d1c-a35f-db2116122489" />

- Captures traffic to/from these IPs.
- use tcp || icmp || arp for broader capture (TCP for port scans, ICMP/ARP for host discovery).


### 5. Scan IP ranges
#### 1. scan entire CIDR IP ranges
````
nmap 192.168.127.0/24
````
<img width="545" height="255" alt="image" src="https://github.com/user-attachments/assets/13643eb4-f053-48be-9158-86e26de1f976" />

#### 2. An alternative is to simply use this kind of range:
````
nmap 192.168.127.1-135
````
<img width="532" height="258" alt="image" src="https://github.com/user-attachments/assets/d79a1ce9-b7d9-4dbc-881d-301820ff456c" />

- Scans the top 1000 TCP ports on each of the 135 IPs.

- Wireshark
````
ip.dst >= 192.168.127.1 && ip.dst <= 192.168.127.135
````
<img width="914" height="479" alt="image" src="https://github.com/user-attachments/assets/f8867534-4a47-49e1-a723-316c02f9b049" />

- Captures traffic destined for the specified IP range.

#### 3. wildcards to scan the entire C class IP range
````
nmap 192.168.127.*
````
<img width="562" height="237" alt="image" src="https://github.com/user-attachments/assets/8adb2109-02f8-4f23-86f9-1228911b1b0e" />

- Wireshark
````
ip.dst >= 192.168.127.0 && ip.dst <= 192.168.127.255
````
<img width="899" height="470" alt="image" src="https://github.com/user-attachments/assets/fe189832-b93f-4805-81a9-2409ecd32f80" />


#### 4. –exclude
````
nmap 192.168.127.0/24 --exclude 192.168.127.129
````
<img width="547" height="246" alt="image" src="https://github.com/user-attachments/assets/fecd97e8-aa1e-41fa-b1cd-c10990c16f73" />

- or we can use this command `nmap 192.168.127.0-255 --exclude 192.168.127.129` it the same.
- scan the 192.168.127.0/24 subnet (all 256 IPs) while excluding 192.168.127.129


- Wireshark
````
(ip.dst >= 192.168.127.0 && ip.dst <= 192.168.127.255) && ip.dst != 192.168.127.129
````
<img width="898" height="516" alt="image" src="https://github.com/user-attachments/assets/dc9e469c-1951-4e94-a10c-f93977bf69f7" />


### 6. Scan the most popular ports
#### 1. –top-ports” parameter along with a specific number
````
nmap --top-ports 20 192.168.127.129
````
<img width="668" height="113" alt="image" src="https://github.com/user-attachments/assets/8fd5e020-958f-45e9-8f2f-cc081afa1978" />

- Scans the top 20 TCP ports on 192.168.127.129.


- wireshark
````
ip.addr == 192.168.127.129
````
<img width="912" height="476" alt="image" src="https://github.com/user-attachments/assets/5ad88b86-628a-47f7-80db-eb848a7cb1fc" />

- Captures traffic to/from 192.168.127.129.

#### 2. find closed port
<img width="551" height="495" alt="image" src="https://github.com/user-attachments/assets/0018efeb-e044-4440-be8a-9e5a3a840e0b" />

- `--top-ports 20` : Scans the 20 most frequently used TCP ports (based on Nmap’s internal database), such as 80 (HTTP), 443 (HTTPS), 22 (SSH), 23 (Telnet), etc.
- Scans the top 20 TCP ports on 127.0.0.1.

- Wireshark
````
ip.addr == 127.0.0.1 && tcp
````
<img width="917" height="481" alt="image" src="https://github.com/user-attachments/assets/324635f6-baf3-40e1-877a-22bbad7cc803" />

- Captures TCP traffic to/from localhost.


### 7. Scan hosts and IP addresses reading from a text file
````
nano list.txt
````
````
192.168.127.128
192.168.127.129
192.168.127.131
````
<img width="200" height="43" alt="image" src="https://github.com/user-attachments/assets/c6d2c518-c051-4ad0-b9fb-06a0b3de2657" />

- Run
````
nmap -iL list.txt
````
<img width="517" height="177" alt="image" src="https://github.com/user-attachments/assets/a6133e3b-67b5-4ea4-a99a-be661e7476c3" />

- `-iL list.txt` : Tells Nmap to read a list of targets (IP addresses, hostnames, or ranges) from the file list.txt.


- Wireshark
````
ip.addr == 192.168.127.1 || ip.addr == 192.168.127.128 || ip.addr == 192.168.127.129 || ip.addr == 192.168.127.131 
````
<img width="891" height="499" alt="image" src="https://github.com/user-attachments/assets/43c57d9e-2936-4492-9780-26214eb5c0e7" />


### 8. Save your Nmap scan results to a file
#### 1. Output file txt
````
nmap -oN output.txt 192.168.127.129
cat output.txt
````
<img width="894" height="256" alt="image" src="https://github.com/user-attachments/assets/e524d575-914c-4aed-91b9-06b13d94128e" />

- `-oN output.txt` : Saves the scan results to output.txt in normal (human-readable) format.
- Scans the top 1000 TCP ports on 192.168.127.129


#### 2. Output file xml
````
nmap -oX output.xml 192.168.127.131
cat output.xml
````
<img width="914" height="651" alt="image" src="https://github.com/user-attachments/assets/c924f2b6-b384-4379-ae0c-626bc8705598" />



### 9. Disabling DNS name resolution
#### 1. disable reverse DNS resolution 
````
nmap -p 80 -n 192.168.127.129
````
<img width="545" height="190" alt="image" src="https://github.com/user-attachments/assets/ca43f083-8301-4979-8f5f-4e3e79cb8b1e" />

- -p 80: Scans only TCP port 80 (HTTP) on the target.
- -n: Disables DNS resolution, meaning Nmap won’t attempt to resolve the IP to a hostname, making the scan faster.


- Wireshark
````
ip.addr == 192.168.127.129 && (tcp.port == 80 || icmp || arp)
````
<img width="749" height="425" alt="image" src="https://github.com/user-attachments/assets/fa265e64-a148-4b98-8348-3a1b6079e465" />

- Captures TCP traffic for port 80, ICMP for host discovery, and ARP for local subnet detection.


#### 2. Scan specific port
````
nmap -p 80 192.168.127.129
````
<img width="522" height="191" alt="image" src="https://github.com/user-attachments/assets/e00e6183-448e-43c5-b312-5a012a33ecb9" />


### 10. Scan + OS and service detection with fast execution
````
nmap -A -T4 scanme.nmap.org
````
<img width="796" height="782" alt="image" src="https://github.com/user-attachments/assets/538bb02d-4086-4554-8f64-22a27d54d874" />


- -A (Aggressive scan) → Enables several advanced features at once:
   - OS detection (-O)
   - Version detection (-sV)
   - Script scanning (-sC)
   - Traceroute
- -T4 (Timing template) → Speeds up the scan

#### Usage:
| Template | Speed            | Use Case                     | Stealth       |
| -------- | ---------------- | ---------------------------- | ------------- |
| **T0**   | Very slow        | IDS evasion                  | Very stealthy |
| **T1**   | Slow             | High stealth scans           | Stealthy      |
| **T2**   | Medium-slow      | Reduce bandwidth/server load | Some stealth  |
| **T3**   | Normal (default) | General use                  | Balanced      |
| **T4**   | Fast             | Internal testing, lab scans  | Noisy         |
| **T5**   | Very fast        | Labs, CTF, DoS testing       | Very noisy    |


- Wireshark

<img width="785" height="659" alt="image" src="https://github.com/user-attachments/assets/7d4fff15-a30d-402d-a2c4-a2e215c69dc1" />

<img width="782" height="635" alt="image" src="https://github.com/user-attachments/assets/3e180ee6-3730-41e1-93e5-19bd15d54ea9" />

- Captures traffic to/from scanme.nmap.org (IP: 45.33.32.156).



### 11. Detect service/daemon versions
````
nmap -sV localhost
````
<img width="690" height="202" alt="image" src="https://github.com/user-attachments/assets/ef2bbdbc-3c60-4e10-977e-0cce0bf26283" />

- `-sV (Service Version Detection` : Nmap tries to detect the version of services running on open ports (e.g., Apache httpd 2.4.57, OpenSSH 8.9p1).
- `localhost` : The target is your own machine (127.0.0.1).



### 12. Scan using TCP or UDP protocols
#### 1. Standard TCP scanning output:
````
nmap -sT 192.168.127.129
````
<img width="491" height="508" alt="image" src="https://github.com/user-attachments/assets/877ca368-6f46-4ef7-b608-7e5f798c18ea" />

- `-sT` : Specifies a TCP connect scan, which performs a full TCP handshake (SYN → SYN/ACK → ACK) on each targeted port.

- Wireshark:
````
ip.addr == 192.168.127.129 && (tcp || icmp || arp)
````
<img width="789" height="576" alt="image" src="https://github.com/user-attachments/assets/d78992b4-6352-45c1-8d8c-e852ce11ea3f" />

- Captures TCP traffic for the port scan, ICMP for host discovery, and ARP for local subnet detection.


#### 2. UDP Scan
````
nmap -sU 192.168.127.129
````
<img width="505" height="287" alt="image" src="https://github.com/user-attachments/assets/13e98265-d625-4170-9537-c619b9e25f4a" />


- `-sU` : Specifies a UDP scan, which sends UDP packets to the target ports to determine their state (open, closed, or filtered).


- Wireshark:
````
ip.addr == 192.168.127.129 && (udp || icmp || arp)
````
<img width="817" height="635" alt="image" src="https://github.com/user-attachments/assets/fdc9ec54-463a-4524-acd4-bcce3122f5f5" />

- Captures UDP traffic for the port scan, ICMP for host discovery or port responses, and ARP for local subnet detection.



### 13. CVE detection using Nmap
````
nmap -Pn --script vuln 192.168.127.129
````
<img width="912" height="761" alt="image" src="https://github.com/user-attachments/assets/3a900dd3-9593-41cb-98da-9d8b470ee953" />

<img width="887" height="633" alt="image" src="https://github.com/user-attachments/assets/5de3a5dc-09b6-4a4e-a5bf-7a92a5d42298" />

<img width="880" height="731" alt="image" src="https://github.com/user-attachments/assets/013ca739-d82b-4484-9c9c-9515b552da2f" />

<img width="865" height="582" alt="image" src="https://github.com/user-attachments/assets/6d8831de-af0d-47fc-b033-52f52c30797f" />

- `-Pn` : Disables host discovery (ping scan), treating the target as online and proceeding directly to port scanning.
- `--script vuln` : Runs Nmap Scripting Engine (NSE) scripts in the vuln category, which check for known vulnerabilities in services on open ports (e.g., outdated software, misconfigurations).

- Wireshark:
````
ip.addr == 192.168.127.129 && (tcp || icmp || arp)
````
<img width="917" height="792" alt="image" src="https://github.com/user-attachments/assets/ff513906-11a8-4604-a794-6da5493605a8" />

- Captures TCP traffic for the port scan, ICMP for potential script responses, and ARP for local subnet detection.



### 14. Flood testing with Nmap
````
nmap 192.168.127.129 -max-parallelism 800 -Pn --script http-slowloris --script-args http-slowloris.runforever=true
````
<img width="892" height="130" alt="image" src="https://github.com/user-attachments/assets/dde37d0e-e6ee-4c66-b0ad-c8d9a9e341de" />


- `-Pn` : Disables host discovery (ping scan), assuming the host is up and proceeding directly to port scanning.
- `-max-parallelism 800` : Sets the maximum number of parallel probes to 800, increasing scan speed by sending many packets simultaneously.
- `--script http-slowloris` : Runs the http-slowloris NSE script, which tests HTTP servers for vulnerability to the Slowloris DoS attack by opening multiple connections and sending partial HTTP requests to exhaust server resources.
- `--script-args http-slowloris.runforever=true` : Configures the script to run indefinitely, continuously sending partial HTTP requests until you stop it manually (e.g., with Ctrl+C). Without this, the script runs for a default duration (typically 30 minutes).
- initiates a TCP connect scan (-sT) on the top 1000 TCP ports for the target IP 192.168.127.129, with host discovery disabled (-Pn), high parallelism (-max-parallelism 800), and the http-slowloris Nmap Scripting Engine (NSE) script to test for Slowloris denial-of-service (DoS) vulnerabilities on HTTP services. The --script-args http-slowloris.runforever=true argument makes the script run indefinitely until manually stopped.


- Wireshark:
````
ip.addr == 192.168.127.129 && (tcp || icmp || arp)
````
<img width="921" height="761" alt="image" src="https://github.com/user-attachments/assets/19388a15-3612-4617-afe4-483094c8f76d" />

- Captures TCP traffic for the port scan and Slowloris script, ICMP for potential responses, and ARP for local subnet detection.


### 15. modified with four options
````
nmap -p0- -v -A -T4 192.168.127.129
````
<img width="582" height="666" alt="image" src="https://github.com/user-attachments/assets/dd873a5c-9c6d-48aa-87d6-644cf23d94da" />

<img width="596" height="527" alt="image" src="https://github.com/user-attachments/assets/0cc85eaf-a91c-412d-b78b-20f3a2bfc0ae" />

- `-p0-` : Scans all TCP ports (0–65535, including the reserved port 0, though it’s rarely used).
- `-v` : Enables verbose output, showing detailed progress during the scan.
- `-A` : OS Detection, Version detection, script scanning.
- -T4: Sets the timing template to "aggressive," speeding up the scan by reducing probe delay.


### 16. Python script about nmap port scanning
````
#!/usr/bin/env python3

import nmap
import sys

class Colors:
    RED = '\033[0;31m'
    GREEN = '\033[0;32m'
    YELLOW = '\033[1;33m'
    NC = '\033[0m'  
def print_color(text, color):
    print(f"{color}{text}{Colors.NC}")

def main():
    scanner = nmap.PortScanner()

    print_color("===================================", Colors.GREEN)
    print_color("     Python Nmap Port Scanner      ", Colors.GREEN)
    print_color("===================================", Colors.GREEN)

    target = input("Enter target IP address or hostname: ").strip()
    if not target:
        print_color("[!] No target provided. Exiting.", Colors.RED)
        sys.exit(1)

    print_color(f"[*] Target: {target}", Colors.YELLOW)

    print("\nSelect Scan Type:")
    print("1) Fast Scan (Top 100 ports)")
    print("2) Full Port Scan (1-65535)")
    print("3) Service Version Detection")
    print("4) OS Detection")
    print("5) Aggressive Scan")
    print("6) Custom Port Range")

    choice = input("Enter choice (1-6): ").strip()

    try:
        if choice == '1':
            print_color("[*] Running Fast Scan (top 100 ports)...", Colors.YELLOW)
            scanner.scan(target, arguments='-F')

        elif choice == '2':
            print_color("[*] Running Full Port Scan (1-65535)... This may take a while.", Colors.YELLOW)
            scanner.scan(target, '1-65535')

        elif choice == '3':
            print_color("[*] Running Service Version Detection (-sV)...", Colors.YELLOW)
            scanner.scan(target, arguments='-sV')

        elif choice == '4':
            print_color("[*] Running OS Detection (-O)...", Colors.YELLOW)
            scanner.scan(target, arguments='-O')

        elif choice == '5':
            print_color("[*] Running Aggressive Scan (-A)...", Colors.YELLOW)
            scanner.scan(target, arguments='-A')

        elif choice == '6':
            ports = input("Enter port range (e.g., 1-1000 or 22,80,443): ").strip()
            if not ports:
                print_color("[!] No port range provided.", Colors.RED)
                sys.exit(1)
            print_color(f"[*] Scanning ports: {ports}", Colors.YELLOW)
            scanner.scan(target, ports)

        else:
            print_color("[!] Invalid choice. Exiting.", Colors.RED)
            sys.exit(1)

    except Exception as e:
        print_color(f"[!] Error during scan: {str(e)}", Colors.RED)
        sys.exit(1)

    print_color("\n[*] Scan Results:", Colors.GREEN)
    if target not in scanner.all_hosts():
        print_color("[!] No results returned. Target may be unreachable.", Colors.RED)
        sys.exit(1)

    host = scanner[target]
    print(f"Host: {target} ({host.hostname()})")
    print(f"State: {host.state()}")

    for proto in host.all_protocols():
        print(f"\nProtocol: {proto}")
        ports = host[proto].keys()
        for port in sorted(ports):
            state = host[proto][port]['state']
            name = host[proto][port].get('name', 'unknown')
            version = host[proto][port].get('version', '')
            product = host[proto][port].get('product', '')
            info = f" ({product} {version})" if product or version else ''
            print(f"  Port {port}: {state} - {name}{info}")

    print_color("\n[+] Scan completed.", Colors.GREEN)

if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print_color("\n\n[!] Scan interrupted by user.", Colors.RED)
        sys.exit(0)
````
- Install requirement:
````
python3 -m venv ~/Documents/TOOLS_SCRIPT/venv
source ~/Documents/TOOLS_SCRIPT/venv/bin/activate
pip install python-nmap
ls -l
mv "nmap_port_scanning .py" nmap_port_scanning.py
ls -l
````
<img width="862" height="605" alt="image" src="https://github.com/user-attachments/assets/9e7ad3d6-76b4-4b83-86a6-57a65d40e1a3" />

<img width="487" height="454" alt="image" src="https://github.com/user-attachments/assets/a4e83a31-5acc-4764-9742-e2c795fb0115" />

- Use script:
````
 python nmap_port_scanning.py
192.168.127.129
2
````
<img width="473" height="271" alt="image" src="https://github.com/user-attachments/assets/d20d1f9a-fae7-4438-b165-0fbc0333084f" />

<img width="477" height="566" alt="image" src="https://github.com/user-attachments/assets/f533694f-ca17-4167-8b05-096be8b06094" />

### ============>>> End Of Nmap

### Why Hackers (and Pentesters) Use Nmap Port Scanning:
Port scanning is usually the first step in hacking or penetration testing:
- Discover Open Doors (Ports)
- Identify Running Services
- Map the Network
- Find Weaknesses
- Plan the Next Attack Step



### Creditable
1. https://www.recordedfuture.com/threat-intelligence-101/tools-and-techniques/nmap-commands
2. https://nmap.org/book/port-scanning-tutorial.html
3. https://nmap.org/book/man-port-scanning-techniques.html


### Practice in LAB BY: Nin Kanong(k4n0ng)

#### Date: 30/Aug/2025
