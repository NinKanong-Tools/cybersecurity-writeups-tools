# Masscan

<img width="918" height="506" alt="image" src="https://github.com/user-attachments/assets/7c02f9f0-59fc-4c71-97b3-082891fc0871" />



### What is masscan?
Masscan is an open-source, high-speed TCP port scanner created by Robert Graham, designed to scan large networks (e.g., the entire internet) in minutes, transmitting up to 10 million packets per second


### LAB TOOLS
- Kali Linux
- Metasploitable2


### Installation
````
masscan --version
````
<img width="573" height="163" alt="image" src="https://github.com/user-attachments/assets/040c982a-6c9c-4526-8f2f-849d1d4a5171" />

- In kali it already installed.

#### But if it not yet installed just type command below:
````
sudo apt update && sudo apt install masscan
````

- Or from source:
````
sudo apt install -y git make gcc libpcap-dev
git clone https://github.com/robertdavidgraham/masscan
cd masscan
make -j
sudo cp bin/masscan /usr/local/bin/
````

- But i already have it in kali i don't show how to downloads.


### Usage:

| **Option**                  | **Description**                                                                  | **Example**                       |
| --------------------------- | -------------------------------------------------------------------------------- | --------------------------------- |
| `-p (ports)`                | Specify ports to scan (comma-separated or ranges).                               | `-p80,443`                        |
| `--top-ports (n)`           | Scan the top *n* most common ports (per Nmap’s database).                        | `--top-ports 100`                 |
| `--rate (packets/sec)`      | Set packet transmission rate (e.g., 1000 for safe, 1000000 for fast).            | `--rate 1000`                     |
| `--adapter-ip (ip)`         | Set source IP for scans.                                                         | `--adapter-ip 192.168.1.100`      |
| `--source-ip (ip)`          | Spoof source IP (requires firewall config).                                      | `--source-ip 192.168.1.200`       |
| `--source-port (port)`      | Set source port to avoid OS stack conflicts.                                     | `--source-port 40000`             |
| `--banners`                 | Grab service banners (limited protocols, e.g., HTTP, FTP).                       | `--banners`                       |
| `--open-only`               | Report only open ports.                                                          | `--open-only`                     |
| `-oL (file)`                | Output to a list format (`IP:port` per line).                                    | `-oL output.txt`                  |
| `-oX (file)`                | Output to XML format.                                                            | `-oX output.xml`                  |
| `-oG (file)`                | Output to grepable format (Nmap-like).                                           | `-oG output.txt`                  |
| `-oJ (file)`                | Output to JSON format.                                                           | `-oJ output.json`                 |
| `--output-format (format)`  | Specify output format (`xml`, `grepable`, `json`, `list`, `binary`).             | `--output-format xml`             |
| `--exclude (ip)`            | Exclude specific IP from scan.                                                   | `--exclude 192.168.1.100`         |
| `--excludefile (file)`      | Exclude IPs listed in a file.                                                    | `--excludefile exclude.txt`       |
| `--http-user-agent (agent)` | Set custom HTTP User-Agent for banner grabbing.                                  | `--http-user-agent "Mozilla/5.0"` |
| `--ping`                    | Include ICMP ping to check host status (unlike Nmap’s default).                  | `--ping`                          |
| `--resume (file)`           | Resume a paused scan (after Ctrl+C).                                             | `--resume paused.conf`            |
| `--shards x/y`              | Split scan across multiple instances (`x = instance ID`, `y = total instances`). | `--shards 1/2`                    |
| `--offline`                 | Simulate scan without sending packets (for timing estimates).                    | `--offline`                       |
| `--nmap`                    | Show Nmap-compatible options.                                                    | `--nmap`                          |
| `--echo`                    | Dump current configuration to a file.                                            | `--echo > config.conf`            |
| `--pcap (file)`             | Save sent packets to a PCAP file for Wireshark.                                  | `--pcap output.pcap`              |
| `--packet-trace`            | Print packets to terminal (slow at high rates).                                  | `--packet-trace`                  |


### 1. Basic scans
#### 1. Single host, single port
````
sudo masscan 192.168.127.129 -p80
````
<img width="607" height="151" alt="image" src="https://github.com/user-attachments/assets/97cf1065-30e4-4fe3-be2d-0b7422add34d" />

- `-p80` : Scans only port 80 (HTTP)

#### 2. Single host, multiple ports
````
sudo masscan 192.168.127.129 -p22,80,445
````
<img width="607" height="159" alt="image" src="https://github.com/user-attachments/assets/3490c2eb-bb6d-4ceb-8e5a-6919612275eb" />

- -p22,80,445: Scans three specific TCP ports:
   - 22: SSH (Secure Shell, commonly used for remote access).
   - 80: HTTP (web server, e.g., Apache or Nginx).
   - 445: SMB (Server Message Block, used for file sharing, often on Windows or Samba servers).

#### 3. All ports on a host
````
sudo masscan 192.168.127.129 -p0-65535
````
<img width="639" height="308" alt="image" src="https://github.com/user-attachments/assets/413e3c84-2bc9-4b20-bbdc-71deeb4a8742" />

- In this it will show all port but it spend a long time, so i skip some.
- Scans all 65,535 TCP ports.
- `-p0-65535` : Scans all 65,536 TCP ports (0–65535, including the reserved port 0, though it’s rarely used).


#### 4. Subnet scan
````
sudo masscan 192.168.127.0/24 -p80
````
<img width="609" height="150" alt="image" src="https://github.com/user-attachments/assets/9ca3aba2-940e-4fbc-9c6f-dba29ae1019c" />

- Scans all devices in your subnet on port 80.


### 2. Controlling Speed
#### 1. Set scan rate
````
sudo masscan 192.168.127.0/24 -p80 --rate=1000
````
<img width="608" height="122" alt="image" src="https://github.com/user-attachments/assets/e3d55622-94b9-4874-98c5-91fd647c0507" />

- `--rate=1000` : Limits the packet transmission rate to 1000 packets per second, a relatively safe rate to avoid overwhelming your lab network.
- Limits to 1,000 packets/sec.

#### 2. High-speed Internet scan (be careful!)
````
sudo masscan 8.8.8.0/0 -p443 --rate=500000
````

<img width="625" height="141" alt="image" src="https://github.com/user-attachments/assets/19c8098c-5419-48ad-aa4e-682bd019a903" />

- `-p443` : Scans only port 443 (HTTPS, commonly used for secure web servers like Apache or Nginx with SSL/TLS).
- `--rate=500000` : Sends 500,000 packets per second, a very high rate requiring significant bandwidth (e.g., 10-Gbps NIC) and optimized setup (e.g., PF_RING drivers).
- Scans the entire Internet for HTTPS


### 3. Output Options
#### 1. Save to text
````
sudo masscan 192.168.127.0/24 -p80 --rate=1000 -oL results.txt
cat results.txt
````

<img width="620" height="209" alt="image" src="https://github.com/user-attachments/assets/9cd1b942-d9ac-496f-a980-6b5b9702b23b" />

- `-oL results.txt` : Saves output in list format to results.txt (format: open tcp <port> <ip>).
- Scans port 80 on all 256 IPs in 192.168.127.0/24.

#### 2. Save to JSON
````
sudo masscan 192.168.127.0/24 -p80 --rate=1000 -oJ results.json
cat results.json
````
<img width="619" height="108" alt="image" src="https://github.com/user-attachments/assets/a2892958-181f-4b24-9c6f-d1b3dad1fbcc" />

<img width="917" height="114" alt="image" src="https://github.com/user-attachments/assets/6c80f9b5-2a26-4527-a8fa-5ab3f84f7361" />

- `-oJ results.json` : Save output in JSON format to results.json.


#### 3. Save to XML (for Nmap)
````
sudo masscan 192.168.127.0/24 -p80 --rate=1000 -oX results.xml
cat results.xml
````
<img width="620" height="109" alt="image" src="https://github.com/user-attachments/assets/3b7364ae-e845-4a2c-aa2d-6c341280bd55" />

<img width="905" height="222" alt="image" src="https://github.com/user-attachments/assets/da650859-7b7c-4201-9497-372432ccf6a2" />


- `-oJ results.xml` : Save output in XML format to results.xml.


### 4. Advanced Targeting
#### 1. Exclude IPs
````
sudo masscan 192.168.127.0/24 -p80 --exclude 192.168.127.129
````
<img width="633" height="111" alt="image" src="https://github.com/user-attachments/assets/78e0d410-33ec-400a-a1af-565996e63bf6" />

- `--exclude 192.168.127.129` : Exclude this specific IP from the scan. Even though it's in the 192.168.127.0/24 range, masscan will skip it. Useful if you want to avoid scanning a sensitive device (like your own machine or a production server).


#### 2. Randomize order
````
sudo masscan 192.168.127.0/24 -p80 --randomize-hosts
````
<img width="605" height="133" alt="image" src="https://github.com/user-attachments/assets/8a0374cb-1ef9-415b-9159-f7441de8edaf" />

- `--randomize-hosts` : Randomize the order in which IP addresses are scanned. By default, masscan scans sequentially (.1, .2, .3, etc.). With this flag, it shuffles the target list — useful for stealth or load distribution.


#### 3. Scan a file of targets
````
nano target.txt
````
<img width="185" height="49" alt="image" src="https://github.com/user-attachments/assets/4b3f82e5-8efe-4916-8065-224b5371c2ce" />

````
192.168.127.128
192.168.127.129
192.168.100.97
````
<img width="404" height="266" alt="image" src="https://github.com/user-attachments/assets/7dacaa27-73b8-4b78-b5db-e3f4545cf4ca" />

````
sudo masscan -iL targets.txt -p22,80,443
````
<img width="631" height="147" alt="image" src="https://github.com/user-attachments/assets/6bef5568-e348-4a60-b2e8-c5c92fbb9e35" />

- `-iL targets.txt` : Read target IPs from a file named targets.txt. Each line in the file should contain one IP address or subnet.


### 5. Stealth / Evasion
#### 1. Use fake source port
````
sudo masscan 192.168.127.129 -p22 --source-port=53
````
<img width="611" height="130" alt="image" src="https://github.com/user-attachments/assets/90e428b0-947b-4b72-995d-0fd513399cd6" />

- `-p22` : Scan only port 22, which is the default port for SSH (Secure Shell).
- `--source-port=53` : Set the source port of the scan packets to 53.
- Looks like DNS traffic.


#### 2. Custom source IP
````
sudo masscan 192.168.127.129 -p80 --adapter-ip 192.168.127.200
````
<img width="630" height="125" alt="image" src="https://github.com/user-attachments/assets/ab8655a2-ed3e-4ef5-9589-be4c7bb9bfed" />

- `--adapter-ip 192.168.127.200` : Tells masscan to use 192.168.127.200 as the source IP address


#### 3. Fragment packets (avoid IDS)
````
sudo masscan 192.168.127.129 -p80 --fragment
````
<img width="604" height="138" alt="image" src="https://github.com/user-attachments/assets/73785432-4123-4096-948f-8178519f2522" />

- `--fragment` : Tells masscan to fragment outgoing packets.



### 6. Protocol Scans
#### 1. UDP scan
````
sudo masscan 192.168.127.129 -pU:53
````
<img width="630" height="129" alt="image" src="https://github.com/user-attachments/assets/3dce345e-92fc-49a3-93e5-bf1543c72285" />

- `-pU:53` : This tells masscan to scan port 53 using UDP

#### 2. Mixed TCP + UDP
````
sudo masscan 192.168.127.129 -p80,U:53
````
<img width="636" height="140" alt="image" src="https://github.com/user-attachments/assets/283911dc-6c20-4e16-9f79-0d41c051653a" />

- `-p80,U:53`:
   - `-p` : flag specifies which ports to scan.
   - `80` : refers to TCP port 80, which is commonly used for HTTP (web servers, like those hosting websites).
   - `U:53` : specifies UDP port 53, which is typically used for DNS (Domain Name System) services, such as resolving domain names to IP addresses.
   - `U` : prefix explicitly indicates that port 53 should be scanned using UDP packets, as opposed to TCP. Without this, masscan would assume TCP for all ports.



### 7. Combining Masscan + Nmap
#### 1. Masscan
````
sudo masscan 192.168.127.0/24 -p0-65535 --rate=5000 -oL masscan_results.txt
````
<img width="696" height="122" alt="image" src="https://github.com/user-attachments/assets/02eb246d-c54e-4c69-8f07-5199fd92fac3" />


#### 2. Extract IPs & send to Nmap
````
awk '/open/{print $4}' masscan_results.txt > open_hosts.txt
nmap -sV -iL open_hosts.txt
````
<img width="906" height="619" alt="image" src="https://github.com/user-attachments/assets/2263b4f3-793b-4e77-beae-00e683a56d4c" />

<img width="903" height="704" alt="image" src="https://github.com/user-attachments/assets/2891cfef-48ea-4100-9466-4b1d23bd98f5" />


### 8. Very Advanced
#### 1. Banner grabbing
````
sudo masscan 192.168.127.129 -p80 --banners
````
<img width="610" height="105" alt="image" src="https://github.com/user-attachments/assets/fa4e365b-1782-48f7-a7cf-8cc515b5424e" />

- `--banners` : Instructs masscan to attempt to grab banner information from the open port, which may reveal details about the service running on port 80 (e.g., web server software like Apache or Nginx, including version numbers).

### 2. Multiple interfaces
````
sudo masscan 192.168.127.0/24 -p80 --interface eth0 --adapter-ip 192.168.127.200
````
<img width="680" height="143" alt="image" src="https://github.com/user-attachments/assets/11b196c1-bc9f-4c7a-8318-83626a92630c" />

- `--interface eth0` : Specifies the network interface (eth0) to use for sending packets. This ensures masscan uses the correct network adapter (e.g., a specific Ethernet connection) on the scanning machine.
- `--adapter-ip 192.168.127.200` : Sets the source IP address for outgoing packets to 192.168.127.200. This is useful when the scanning machine has multiple IP addresses or interfaces, ensuring packets appear to originate from this specific IP.
- Distributed scan (with multiple machines)



### 9. Quick port identification
````
sudo masscan 192.168.127.0/24 -p0-65535 --rate 1000000 --open-only \            
--http-user-agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:67.0) Gecko/20100101 Firefox/67.0" \
-oL output.txt
````
<img width="844" height="141" alt="image" src="https://github.com/user-attachments/assets/f1744f64-a11f-4a79-9a8b-12c81bb3dc07" />

- `-p0-65535` : Scan all 65,535 TCP ports on every host.
- `--rate 1000000` : Scan speed = 1,000,000 packets per second.
- `--open-only` : Only output open ports, ignore closed/filtered ones.
- `--http-user-agent "Mozilla/5.0 (...) Firefox/67.0"` : When grabbing HTTP banners, Masscan will pretend to be Firefox 67 on Windows 10.
- `-oL output.txt` : Save results in List format to output.txt.



### 10. Multiple targets specific scan
````
masscan 192.168.127.128 192.168.127.129 192.168.100.97 \
-p80,443 --rate 100000 --banners --open-only \
--http-user-agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:67.0) Gecko/20100101 Firefox/67.0" \
--source-ip 192.168.127.135 -oL output.txt
````
<img width="899" height="334" alt="image" src="https://github.com/user-attachments/assets/6a71917b-2567-4b53-9ab1-779a3382e971" />

- `--banners` : Try to grab service banners (like Nmap -sV).
- `--http-user-agent ...` : When grabbing HTTP banners, pretend to be Firefox 67 on Windows 10.
- `--source-ip 192.168.127.135` : Spoofs the source IP of the scan.
- `-oL output.txt` : Save results in List format into output.txt.



### 11. TOP 20 ports scanning
````
masscan 192.168.127.129 \
-p21,22,23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,8080 \
--http-user-agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:67.0) Gecko/20100101 Firefox/67.0" \
--rate 100000 -oL output.txt
cat output.txt
````
<img width="860" height="243" alt="image" src="https://github.com/user-attachments/assets/c3fd99c8-f467-4879-b18f-eb33cf266b61" />

- `-p21,22,...,8080` :
   Scans a curated list of the most common ports:
   - 21 → FTP
   - 22 → SSH
   - 23 → Telnet
   - 25 → SMTP
   - 53 → DNS
   - 80, 443, 8080 → Web services
   - 110, 143, 993, 995 → Email services (POP3, IMAP, etc.)
   - 135, 139, 445 → Windows SMB services
   - 111 → RPC
   - 1723 → PPTP VPN
   - 3306 → MySQL
   - 3389 → RDP
   - 5900 → VNC
- `--http-user-agent ...` : When scanning web ports (80/443/8080),Masscan will request banners as if it’s Firefox on Windows 10.



### 12. chain Masscan with Nmap
````
masscan 192.168.127.0/24 -p21,22,23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,8080 --rate 10000 -oG masscan.gnmap

grep "Ports:" masscan.gnmap | awk '{print $2}' | sort -u | \
xargs -I{} nmap -sV -p21,22,23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,8080 {}
````
<img width="891" height="108" alt="image" src="https://github.com/user-attachments/assets/94671a68-4c43-4272-a91a-ffc436aa18f8" />

<img width="887" height="139" alt="image" src="https://github.com/user-attachments/assets/6c7ed603-eeec-49b9-b8d3-544811792c6a" />

- Masscan finds open ports and Nmap identifies services & versions.




#### ============>>> End Of Masscan

### Why Hacker and pentest use masscan?
Hackers (and penetration testers) use Masscan because it is one of the fastest port scanners in the world. like:
- Speed:
  - Masscan can scan the entire Internet (4 billion IPs) in under 6 minutes (with the right bandwidth & hardware).
  - This is much faster than Nmap.
- Large-Scale Reconnaissance:
  - Hackers who want to find vulnerable targets quickly use Masscan.
- Stealth / Evasion:
  - Masscan lets you control speed with --rate.
- Banner Grabbing:
  - With --banners, Masscan doesn’t just say “port open” — it can grab service banners (like Apache, SSH versions).
- Precision Targeting:
  - Instead of wasting time on 65k ports, hackers can custom-select high-value ports (22, 80, 445, 3306, etc.).


### Creditable:
1. https://cheatsheet.haax.fr/network/port-scanning/masscan_cheatsheet/
2. https://www.techtarget.com/searchsecurity/tutorial/How-to-use-Masscan-for-high-speed-port-scanning


### Practice in LAB BY: Nin Kanong(k4n0ng)
#### Date: 31/Aug/2025
