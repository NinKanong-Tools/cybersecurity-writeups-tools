# Nmap Service Version Detection

<img width="1024" height="535" alt="Nmap-1024x535" src="https://github.com/user-attachments/assets/47e14c9c-7306-4c56-b157-98a84dd1fe7d" />

### What is Nmap service version detection?
Nmap service version detection is a powerful feature of the Nmap (Network Mapper) tool that identifies the specific services and their versions running on open ports of a target system.


### LAB TOOLS
- Kali Linux
- metasploitable2


## Usage:

- `-sV` : service version detection

### 1. Basic Version Scan:
````
nmap -sV 192.168.127.129
````
<img width="879" height="583" alt="image" src="https://github.com/user-attachments/assets/3cd2585b-8acd-4edc-ab9f-4801117f5ae7" />

- Detects service versions on default ports (1-1024 and common ports).


### 2. Version Scan on a Single Port:
````
nmap -sV -p 80 192.168.127.129
````
<img width="761" height="210" alt="image" src="https://github.com/user-attachments/assets/6545f0e6-da6c-4ab2-bfbb-31579d2a5372" />

- This command use for specific port.


### 3. Version Scan with a Small Port Range:
````
nmap -sV -p 1-100 192.168.127.129
````
<img width="786" height="303" alt="image" src="https://github.com/user-attachments/assets/ace65d6d-9f5e-488a-8b2d-f8e1ec9f4c78" />

- Scans ports 1-100 for service versions.


### 4. Verbose Output for Clarity:
````
nmap -sV -v 192.168.127.129
````
<img width="591" height="753" alt="image" src="https://github.com/user-attachments/assets/e8f6eee6-14cd-4f67-ac18-aa7a03e69c22" />

<img width="885" height="520" alt="image" src="https://github.com/user-attachments/assets/2e2ef9d2-9d5c-49e9-aa47-b0bd941268a5" />

- Adds detailed progress and results, helpful for learning.


### 5. Version Scan with Specific Ports:
````
nmap -sV -p 21,22,80,139,445 192.168.127.129
````
<img width="762" height="283" alt="image" src="https://github.com/user-attachments/assets/7fd993fd-49e2-434a-8aa6-2c74e856938b" />

- Targets key Metasploitable2 ports (FTP, SSH, HTTP, SMB).


### 6. Combine with OS Detection:
````
nmap -sV -O 192.168.127.129
````
<img width="896" height="668" alt="image" src="https://github.com/user-attachments/assets/428dd19a-0349-4f8e-bb76-16e7a147d393" />

- This command will adds OS fingerprinting alongside service versions.


### 7. Save Results in Normal Format:
````
nmap -sV -oN nmap_version_scan.txt 192.168.127.129
````
<img width="884" height="589" alt="image" src="https://github.com/user-attachments/assets/c9f6a620-c139-4f67-bf41-2904068ccb43" />

- This command will saves output to a text file for review.


### 8. Faster Scan with Timing Template:
````
nmap -sV -T3 192.168.127.129
````
<img width="891" height="589" alt="image" src="https://github.com/user-attachments/assets/7c0c0058-20ce-414e-adbd-9064f45fbef8" />

- This command uses timing template 3 (normal) to speed up the scan.


### 9. Skip Host Discovery:
````
nmap -sV -Pn 192.168.127.129
````
<img width="887" height="572" alt="image" src="https://github.com/user-attachments/assets/8c7766a2-6231-4dc4-9ed7-a90643f9ba01" />

Scans without pinging, useful if target firewall blocks ICMP.


### 10. Full Port Scan with Version Detection:
````
nmap -sV -p- 192.168.127.129
````
<img width="890" height="698" alt="image" src="https://github.com/user-attachments/assets/9734cbe4-eee4-4919-9d87-a4003b80a8d1" />

- This command will scans all 65535 ports (resource-intensive).


### 11. Maximum Version Detection Intensity:
````
nmap -sV --version-intensity 9 192.168.127.129
````
<img width="882" height="585" alt="image" src="https://github.com/user-attachments/assets/b635640a-50e6-4f73-9d59-9535e1512193" />

- This command will uses the highest probe intensity (0-9) for maximum accuracy.
- Probe Intensity Guide (0–9)
| Intensity | Description                                                    |
| --------- | -------------------------------------------------------------- |
| 0         | Lightest – minimal probes, fastest, less accuracy              |
| 1–4       | Light to medium – balanced for faster scans with some accuracy |
| 5         | Default – balanced between speed and accuracy                  |
| 6–8       | Medium-high – more probes, higher chance of correct version    |
| 9         | Maximum – all probes, slowest, highest accuracy                |



### 12. Aggressive Scan with All Features:
````
nmap -A 192.168.127.129
````
<img width="903" height="735" alt="image" src="https://github.com/user-attachments/assets/f0495451-8270-4848-8229-bfe30ec80b3a" />

<img width="908" height="692" alt="image" src="https://github.com/user-attachments/assets/dfe1ed33-62b9-4298-8b97-d3f1bcbbad86" />

<img width="866" height="383" alt="image" src="https://github.com/user-attachments/assets/5c3fdd68-00df-4259-88c0-2a9ae7819665" />

- Combines -sV, -O, and default NSE scripts for a comprehensive scan.


### 13. Custom Timing and Rate:
````
nmap -sV --min-rate 1000 --max-retries 2 192.168.127.129
````
<img width="884" height="601" alt="image" src="https://github.com/user-attachments/assets/d4c4a294-d271-4525-84ee-576dcde46188" />

- This command will sets a minimum packet rate and limits retries for efficiency.


### 14. UDP Service Version Detection:
````
nmap -sV -sU -p 53,123 192.168.127.129
````

<img width="754" height="224" alt="image" src="https://github.com/user-attachments/assets/44ddeeb9-5d1a-47e0-bfda-8e4b37cfd07c" />

- This command will scans UDP ports 53 (DNS) and 123 (NTP) for versions.


### 15.Run Default NSE Scripts:
````
nmap -sV -sC 192.168.127.129
````

<img width="913" height="700" alt="image" src="https://github.com/user-attachments/assets/6fde79fc-af31-480b-97b2-6e42980aa000" />

<img width="883" height="694" alt="image" src="https://github.com/user-attachments/assets/6c3565ba-63fc-489f-9187-3d892deaafb3" />

- This command will executes default scripts to enhance version detection with vulnerability checks.


### 16. Specific Script for HTTP:
````
nmap -sV -p 80 --script http-enum 192.168.127.129
````
<img width="768" height="351" alt="image" src="https://github.com/user-attachments/assets/bdad4392-3e96-4ae2-bbd4-9e2fb4918ead" />

- This command enumerates web app details on port 80.



### 17.Multiple Output Formats:
````
nmap -sV -oA nmap_version_scan 192.168.127.129
````
<img width="882" height="594" alt="image" src="https://github.com/user-attachments/assets/69441a39-15bd-4ae6-959c-e781be006630" />

- Saves as nmap_version_scan.nmap, .gnmap, and .xml.


### 18. Grepable Output:
````
nmap -sV -oG nmap_version_scan.gnmap 192.168.127.129
````
<img width="894" height="589" alt="image" src="https://github.com/user-attachments/assets/ff5d204f-5dad-47d8-96f0-c1da3836f035" />

- this command will generates a grepable format for scripting.


### 19. XML Output for Automation:
````
nmap -sV -oX nmap_version_scan.xml 192.168.127.129
````
<img width="894" height="595" alt="image" src="https://github.com/user-attachments/assets/238dad90-fa94-4e15-a9a5-c3187af80bb8" />

- Check file:
````
cat nmap_version_scan.gnmap
````
<img width="891" height="286" alt="image" src="https://github.com/user-attachments/assets/d5e680d3-ad8b-41a7-bee5-dffab7bb02c5" />

- `-oX nmap_version_scan.xml` : Saves the scan results in XML format to the file nmap_version_scan.xml

### 20. Debug Mode for Troubleshooting:
````
nmap -sV --packet-trace 192.168.127.129
````
<img width="896" height="748" alt="image" src="https://github.com/user-attachments/assets/df81c37f-b42f-4b90-a073-fb3d7b2cac96" />

<img width="637" height="749" alt="image" src="https://github.com/user-attachments/assets/c1f2a718-63d5-41e8-ac41-3780d3da080d" />

<img width="642" height="704" alt="image" src="https://github.com/user-attachments/assets/c2fe38f5-36ca-401e-9ab7-028be0d41001" />

- `--packet-trace` : Shows all packets sent and received during the scan. Useful for debugging or learning how Nmap interacts with the target.
- This command will show shows packet-level details for debugging.


### 21. Python script for nmap service version detection
````
python -m venv venv
source venv/bin/activate
pip install python-nmap
````
<img width="463" height="329" alt="image" src="https://github.com/user-attachments/assets/810788f0-2e92-434c-bee7-3e94daf95ed1" />

````
mousepad nmap_version_scan.py
````
<img width="843" height="583" alt="image" src="https://github.com/user-attachments/assets/5024e220-8afb-4173-a180-00ed693e197b" />

````
#!/usr/bin/env python3

import nmap

def scan_service_versions(target):
    nm = nmap.PortScanner()

    print(f"[*] Scanning target: {target}")
    print("[*] Running service version detection (this may take a while)...\n")

    try:
        nm.scan(target, arguments='-sV')

        for host in nm.all_hosts():
            print(f"Host: {host} ({nm[host].hostname()})")
            print(f"State: {nm[host].state()}\n")

            for proto in nm[host].all_protocols():
                print(f"Protocol: {proto.upper()}")
                ports = nm[host][proto].keys()

                for port in sorted(ports):
                    state = nm[host][proto][port]['state']
                    name = nm[host][proto][port]['name']
                    product = nm[host][proto][port].get('product', 'unknown')
                    version = nm[host][proto][port].get('version', '')

                    ver = f"{product} {version}".strip()
                    if not ver or ver == "unknown unknown":
                        ver = "unknown"

                    print(f"  Port: {port}/{proto} | State: {state} | Service: {name} | Version: {ver}")
            print("-" * 60)
    except Exception as e:
        print(f"[!] Error scanning {target}: {str(e)}")

if __name__ == "__main__":
    target = input("Enter target IP or domain (e.g., 192.168.1.1 or example.com): ").strip()
    if target:
        scan_service_versions(target)
    else:
        print("[!] No target entered. Exiting.")
````

- Run scriipt:
````
python3 nmap_version_scan.py
````

<img width="795" height="543" alt="image" src="https://github.com/user-attachments/assets/be84d712-3f7c-44ef-8497-eac59587ef6d" />



### ===========>>> End OF Nmap Service version detection

### Why Hacker use nmap for service version detection:
hackers and pentesters use Nmap for service version detection clearly:
- Identify running services : Nmap discovers which services are running on open ports (SSH, HTTP, FTP, etc.), so hackers know what is exposed.
- Determine software versions : Knowing the version (e.g., Apache 2.4.29, OpenSSH 7.6p1) helps find version-specific vulnerabilities.
- Plan attacks : With service + version info, attackers can check databases (CVE, Exploit-DB) to exploit weaknesses.
- Verify firewall/protection : By analyzing service responses, hackers can see if firewalls or IDS/IPS affect traffic.


### Credits:
1. https://systemweakness.com/nmap-os-version-detection-53666016bcbd
2. https://labex.io/tutorials/nmap-how-to-identify-service-version-detected-by-nmap-415678



### Practice in LAB BY: Nin Kanong(k4n0ng)

#### Date:1/Sept/2025
