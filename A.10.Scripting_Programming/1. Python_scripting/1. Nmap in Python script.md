# Nmap in Python scripting

#### - Attacker Machine: Kali Linux
#### - Victim Machine: Metasploitable2 (We can also use any OS with this script)


#### What this script use for?
This Python script is a comprehensive network scanning tool that uses the python-nmap library to perform detailed reconnaissance on a target IP address. It's essentially a custom Nmap wrapper with structured output and error handling.

This script automates and enhances the use of Nmap (Network Mapper) for: 

  - Port scanning
  - Service and version detection
  - OS fingerprinting
  - User-friendly output formatting
     
It's useful for: 

  - Network administrators (checking open services)
  - Security professionals (vulnerability assessment)
  - Ethical hackers (reconnaissance phase)
  - Learning how to integrate Nmap into Python scripts
     

 ## Proccess of script

- First we need to create virtual environment and install python-nmap
```
python3 -m venv ~/nmap-env
source ~/nmap-env/bin/activate
pip install python-nmap
```
<img width="462" height="321" alt="image" src="https://github.com/user-attachments/assets/b08f9b1a-39ca-428c-b810-c58c01ec00be" />



- Script

```
nano python_nmap_scanning.py
```
<img width="318" height="59" alt="image" src="https://github.com/user-attachments/assets/13dbba7d-f603-4756-94e0-ff2bcf4fbb16" />


```
import nmap
import sys
import time

def scan_target(ip, port_range="1-65535", arguments="-sS -sV -O"):
    try:
        nm = nmap.PortScanner()
        
        print(f"[*] Starting Nmap scan on {ip} at {time.ctime()}")
        print(f"[*] Scanning ports: {port_range}")
        print(f"[*] Arguments: {arguments}")
        
        nm.scan(ip, port_range, arguments=arguments)
        
        if ip not in nm.all_hosts():
            print(f"[!] Error: Host {ip} seems down or unreachable")
            return
        
        print(f"\n[+] Scan results for {ip}:")
        print(f"Host state: {nm[ip].state()}")
        
        for proto in nm[ip].all_protocols():
            print(f"\n[+] Protocol: {proto}")
            print("-" * 50)
            
            ports = sorted(nm[ip][proto].keys())
            
            for port in ports:
                state = nm[ip][proto][port]['state']
                service = nm[ip][proto][port].get('name', 'unknown')
                product = nm[ip][proto][port].get('product', '')
                version = nm[ip][proto][port].get('version', '')
                
                print(f"Port: {port}/{proto}")
                print(f"State: {state}")
                print(f"Service: {service}")
                if product:
                    print(f"Product: {product}")
                if version:
                    print(f"Version: {version}")
                print("-" * 30)
        
        if 'osmatch' in nm[ip]:
            print("\n[+] OS Detection Results:")
            for osmatch in nm[ip]['osmatch']:
                print(f"OS Name: {osmatch['name']}")
                print(f"Accuracy: {osmatch['accuracy']}%")
                if 'osclass' in osmatch:
                    for osclass in osmatch['osclass']:
                        print(f"Type: {osclass['type']}")
                        print(f"Vendor: {osclass['vendor']}")
                        print(f"OS Family: {osclass['osfamily']}")
                        print("-" * 30)
        
        print(f"\n[*] Scan completed at {time.ctime()}")
        
    except nmap.PortScannerError as e:
        print(f"[!] Nmap error: {str(e)}")
        print("[!] Ensure you have Nmap installed and are running as root for certain scan types")
    except Exception as e:
        print(f"[!] Unexpected error: {str(e)}")

def main():
    if len(sys.argv) < 2:
        print("Usage: python nmap_port_scanner.py <target_ip> [port_range]")
        sys.exit(1)
    
    target_ip = sys.argv[1]
    port_range = sys.argv[2] if len(sys.argv) > 2 else "1-65535"

    scan_target(target_ip, port_range, arguments="-sS -sV -O")

if __name__ == "__main__":
    main()
```
<img width="628" height="688" alt="image" src="https://github.com/user-attachments/assets/c50ec0e6-5e21-48c9-9e75-1aaee4124823" />

type: Ctrl + o, Enter, Ctrl + x


#### Run script

- Scan all port
```
python python_nmap_scanning.py 192.168.100.102
```
<img width="733" height="700" alt="image" src="https://github.com/user-attachments/assets/9ab27b5d-e02d-4901-9a61-fa22d5bd0aea" />

<img width="545" height="666" alt="image" src="https://github.com/user-attachments/assets/be0bf031-f1b3-4a81-b9af-7335a3a6aa3e" />


- scan specific port

```
python python_nmap_scanning.py 19.168.100.102 1-100-
```
<img width="721" height="693" alt="image" src="https://github.com/user-attachments/assets/d6766bb9-d94d-4d85-90f5-fc4f5a68d75d" />

<img width="547" height="630" alt="image" src="https://github.com/user-attachments/assets/79bfd0bf-e571-4a7b-92a6-203888c4ed22" />


- scan spicific port
```
python python_nmap_scanning.py 192.168.100.102 22,443,80,445,21
```
<img width="715" height="689" alt="image" src="https://github.com/user-attachments/assets/2461676e-be09-4d3f-95c2-cdad8191cd55" />

<img width="529" height="565" alt="image" src="https://github.com/user-attachments/assets/f9b51c39-5215-4c56-9334-121e81c96b8c" />


  ###                                                ====>> Finished <<====


## Practice in LAB By: Nin Kanong(k4n0ng)
### Date: 16/Aug/2025
